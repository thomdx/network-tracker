<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Network Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600;700&family=Geist+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#080808; --s1:#0f0f0f; --s2:#141414; --s3:#1c1c1c;
    --border:#222; --border2:#2a2a2a;
    --text:#e8e8e8; --muted:#555; --muted2:#888; --white:#fff;
    --green:#00d084; --green-d:#00d08415; --green-b:#00d08430;
    --meta:#0082fb; --meta-d:#0082fb15;
    --tt:#ff2d55; --tt-d:#ff2d5515;
    --yt:#ff0000; --yt-d:#ff000015;
    --red:#ff4d4d; --red-d:#ff4d4d15;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--bg);color:var(--text);font-family:'Geist',sans-serif;min-height:100vh;-webkit-font-smoothing:antialiased;}

  /* ‚îÄ‚îÄ LOGIN PAGE ‚îÄ‚îÄ */
  .login-page{display:none;min-height:100vh;align-items:center;justify-content:center;background:var(--bg);}
  .login-page.active{display:flex;}
  .login-box{width:100%;max-width:400px;padding:20px;}
  .login-logo{display:flex;align-items:center;gap:12px;margin-bottom:40px;justify-content:center;}
  .login-logo-mark{width:40px;height:40px;background:var(--green);border-radius:10px;display:flex;align-items:center;justify-content:center;}
  .login-logo-name{font-size:20px;font-weight:700;color:var(--white);}
  .login-card{background:var(--s1);border:1px solid var(--border);border-radius:16px;padding:32px;}
  .login-title{font-size:22px;font-weight:700;color:var(--white);margin-bottom:6px;}
  .login-sub{font-size:13px;color:var(--muted2);margin-bottom:28px;}
  .form-group{margin-bottom:16px;}
  .form-label{font-size:12px;color:var(--muted2);margin-bottom:6px;display:block;font-weight:500;}
  .form-input{width:100%;background:var(--s2);border:1px solid var(--border2);border-radius:8px;padding:11px 14px;font-size:14px;color:var(--white);font-family:'Geist',sans-serif;outline:none;transition:border-color 0.15s;}
  .form-input:focus{border-color:var(--green);}
  .form-input::placeholder{color:var(--muted);}
  .btn-primary{width:100%;background:var(--green);color:#000;border:none;border-radius:8px;padding:12px;font-size:14px;font-weight:600;cursor:pointer;font-family:'Geist',sans-serif;transition:opacity 0.15s;margin-top:8px;}
  .btn-primary:hover{opacity:0.9;}
  .btn-primary:disabled{opacity:0.5;cursor:not-allowed;}
  .login-switch{text-align:center;margin-top:20px;font-size:13px;color:var(--muted2);}
  .login-switch a{color:var(--green);text-decoration:none;cursor:pointer;}
  .form-error{font-size:12px;color:var(--red);margin-top:8px;display:none;}
  .form-error.visible{display:block;}

  /* ‚îÄ‚îÄ APP ‚îÄ‚îÄ */
  .app{display:none;}
  .app.active{display:flex;min-height:100vh;}

  /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
  .sidebar{position:fixed;left:0;top:0;bottom:0;width:220px;background:var(--s1);border-right:1px solid var(--border);display:flex;flex-direction:column;padding:24px 0;z-index:100;}
  .logo{padding:0 20px 24px;border-bottom:1px solid var(--border);margin-bottom:20px;}
  .logo-mark{width:32px;height:32px;background:var(--green);border-radius:8px;display:flex;align-items:center;justify-content:center;margin-bottom:10px;}
  .logo-name{font-size:14px;font-weight:700;color:var(--white);}
  .logo-sub{font-size:11px;color:var(--muted);font-family:'Geist Mono',monospace;}
  .nav{padding:0 10px;flex:1;}
  .nav-section{font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);padding:14px 10px 6px;font-family:'Geist Mono',monospace;}
  .nav-item{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:8px;font-size:13px;color:var(--muted2);cursor:pointer;transition:all 0.15s;margin-bottom:2px;font-weight:500;border:none;background:none;width:100%;text-align:left;}
  .nav-item:hover{background:var(--s2);color:var(--text);}
  .nav-item.active{background:var(--s2);color:var(--white);}
  .nav-icon{width:16px;height:16px;flex-shrink:0;opacity:0.6;}
  .nav-item.active .nav-icon{opacity:1;}
  .live-dot{width:6px;height:6px;background:var(--green);border-radius:50%;margin-left:auto;animation:pulse 2s infinite;}
  .platform-color{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
  .sidebar-footer{padding:16px 20px 0;border-top:1px solid var(--border);}
  .user-info{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
  .user-avatar{width:28px;height:28px;border-radius:50%;background:var(--green-d);border:1px solid var(--green-b);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600;color:var(--green);}
  .user-name{font-size:12px;font-weight:500;color:var(--text);}
  .user-role{font-size:10px;color:var(--muted);font-family:'Geist Mono',monospace;}
  .logout-btn{font-size:11px;color:var(--muted);background:none;border:none;cursor:pointer;font-family:'Geist',sans-serif;padding:0;}
  .logout-btn:hover{color:var(--red);}
  .status-dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:pulse 2s infinite;}

  /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
  .main{margin-left:220px;flex:1;display:flex;flex-direction:column;}
  .topbar{height:56px;border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 28px;gap:12px;background:var(--bg);position:sticky;top:0;z-index:50;}
  .topbar-title{font-size:15px;font-weight:600;color:var(--white);flex:1;}
  .topbar-date{font-size:12px;color:var(--muted2);font-family:'Geist Mono',monospace;}
  .refresh-btn{width:30px;height:30px;border-radius:7px;border:1px solid var(--border2);background:var(--s2);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--muted2);transition:all 0.15s;}
  .refresh-btn:hover{border-color:var(--green);color:var(--green);}
  .content{padding:28px;flex:1;}

  /* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
  .page{display:none;}
  .page.active{display:block;}

  /* ‚îÄ‚îÄ STATS GRID ‚îÄ‚îÄ */
  .stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:20px;}
  .stat-card{background:var(--s1);border:1px solid var(--border);border-radius:12px;padding:18px;transition:border-color 0.2s;}
  .stat-card:hover{border-color:var(--border2);}
  .stat-label{font-size:11px;color:var(--muted2);font-weight:500;margin-bottom:10px;}
  .stat-value{font-size:26px;font-weight:700;color:var(--white);letter-spacing:-1px;line-height:1;margin-bottom:6px;font-variant-numeric:tabular-nums;}
  .stat-value .currency{font-size:14px;font-weight:500;color:var(--muted2);}
  .stat-change{font-size:11px;font-family:'Geist Mono',monospace;}
  .stat-change.up{color:var(--green);}
  .stat-change.down{color:var(--red);}
  .stat-change.neutral{color:var(--muted2);}

  /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
  .section-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px;}
  .card{background:var(--s1);border:1px solid var(--border);border-radius:12px;overflow:hidden;}
  .card-header{padding:16px 18px 12px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
  .card-title{font-size:13px;font-weight:600;color:var(--white);}
  .card-badge{font-size:10px;font-family:'Geist Mono',monospace;color:var(--muted2);background:var(--s2);border:1px solid var(--border);padding:3px 8px;border-radius:4px;}
  .card-body{padding:16px 18px;}

  /* ‚îÄ‚îÄ PLATFORM BARS ‚îÄ‚îÄ */
  .platform-list{display:flex;flex-direction:column;gap:12px;}
  .platform-row{display:grid;grid-template-columns:90px 1fr 70px;align-items:center;gap:10px;}
  .platform-info{display:flex;align-items:center;gap:7px;}
  .platform-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
  .platform-name{font-size:12px;font-weight:500;}
  .bar-track{height:4px;background:var(--s3);border-radius:2px;overflow:hidden;}
  .bar-fill{height:100%;border-radius:2px;transition:width 1s cubic-bezier(0.4,0,0.2,1);}
  .platform-amount{font-size:12px;font-weight:600;color:var(--white);text-align:right;font-family:'Geist Mono',monospace;}

  /* ‚îÄ‚îÄ CONVERSION ‚îÄ‚îÄ */
  .conv-big{display:flex;align-items:flex-end;gap:6px;margin-bottom:12px;}
  .conv-number{font-size:44px;font-weight:700;color:var(--white);letter-spacing:-2px;line-height:1;}
  .conv-pct{font-size:18px;color:var(--muted2);margin-bottom:4px;}
  .conv-desc{font-size:12px;color:var(--muted2);margin-bottom:14px;}
  .conv-bar-label{display:flex;justify-content:space-between;font-size:11px;color:var(--muted2);font-family:'Geist Mono',monospace;margin-bottom:6px;}
  .conv-track{height:5px;background:var(--s3);border-radius:3px;overflow:hidden;}
  .conv-fill{height:100%;background:linear-gradient(90deg,var(--green),#00ffaa);border-radius:3px;transition:width 1.2s cubic-bezier(0.4,0,0.2,1);}

  /* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
  .table-card{background:var(--s1);border:1px solid var(--border);border-radius:12px;overflow:hidden;margin-bottom:20px;}
  .table-wrap{overflow-x:auto;}
  table{width:100%;border-collapse:collapse;}
  thead th{padding:11px 14px;font-size:11px;font-weight:500;color:var(--muted2);text-align:left;border-bottom:1px solid var(--border);font-family:'Geist Mono',monospace;letter-spacing:0.5px;text-transform:uppercase;white-space:nowrap;}
  tbody tr{border-bottom:1px solid var(--border);transition:background 0.1s;}
  tbody tr:last-child{border-bottom:none;}
  tbody tr:hover{background:var(--s2);}
  tbody td{padding:12px 14px;font-size:13px;white-space:nowrap;}
  .platform-tag{display:inline-flex;align-items:center;gap:5px;font-size:11px;font-weight:500;padding:3px 8px;border-radius:4px;}
  .tag-meta{background:var(--meta-d);color:var(--meta);border:1px solid #0082fb25;}
  .tag-tt{background:var(--tt-d);color:var(--tt);border:1px solid #ff2d5525;}
  .tag-yt{background:var(--yt-d);color:var(--yt);border:1px solid #ff000025;}
  .tag-dot{width:5px;height:5px;border-radius:50%;background:currentColor;}
  .payout-cell{font-weight:600;color:var(--green);font-family:'Geist Mono',monospace;}
  .status-badge{display:inline-flex;align-items:center;gap:5px;font-size:11px;padding:3px 8px;border-radius:4px;background:var(--green-d);color:var(--green);border:1px solid var(--green-b);font-family:'Geist Mono',monospace;}
  .time-cell{font-family:'Geist Mono',monospace;font-size:12px;color:var(--muted2);}
  .id-cell{font-family:'Geist Mono',monospace;font-size:11px;color:var(--muted2);}
  .pixel-cell{display:flex;gap:4px;}
  .pixel-dot{width:18px;height:18px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;}
  .pixel-on{background:var(--green-d);color:var(--green);border:1px solid var(--green-b);}
  .pixel-off{background:var(--s3);color:var(--muted);border:1px solid var(--border);}

  /* ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ */
  .filters{display:flex;align-items:center;gap:8px;margin-bottom:16px;flex-wrap:wrap;}
  .filter-btn{padding:7px 14px;border-radius:7px;border:1px solid var(--border);background:var(--s1);color:var(--muted2);font-size:12px;font-weight:500;cursor:pointer;font-family:'Geist',sans-serif;transition:all 0.15s;}
  .filter-btn:hover{border-color:var(--border2);color:var(--text);}
  .filter-btn.active{background:var(--green-d);border-color:var(--green-b);color:var(--green);}

  /* ‚îÄ‚îÄ PIXEL SETTINGS PAGE ‚îÄ‚îÄ */
  .pixel-platforms{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:24px;}
  .pixel-platform-card{background:var(--s1);border:1px solid var(--border);border-radius:12px;padding:20px;cursor:pointer;transition:all 0.2s;}
  .pixel-platform-card:hover{border-color:var(--border2);}
  .pixel-platform-card.selected{border-color:var(--green);background:var(--green-d);}
  .pp-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;margin-bottom:12px;font-size:18px;}
  .pp-name{font-size:14px;font-weight:600;color:var(--white);margin-bottom:4px;}
  .pp-status{font-size:11px;font-family:'Geist Mono',monospace;}
  .pp-status.connected{color:var(--green);}
  .pp-status.disconnected{color:var(--muted2);}

  .pixel-form{background:var(--s1);border:1px solid var(--border);border-radius:12px;padding:24px;display:none;}
  .pixel-form.visible{display:block;}
  .pixel-form-title{font-size:15px;font-weight:600;color:var(--white);margin-bottom:4px;}
  .pixel-form-sub{font-size:12px;color:var(--muted2);margin-bottom:20px;}
  .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;}
  .btn-save{background:var(--green);color:#000;border:none;border-radius:8px;padding:10px 20px;font-size:13px;font-weight:600;cursor:pointer;font-family:'Geist',sans-serif;transition:opacity 0.15s;}
  .btn-save:hover{opacity:0.9;}
  .btn-secondary{background:var(--s2);color:var(--text);border:1px solid var(--border2);border-radius:8px;padding:10px 20px;font-size:13px;font-weight:500;cursor:pointer;font-family:'Geist',sans-serif;margin-left:8px;}
  .success-msg{font-size:12px;color:var(--green);margin-top:10px;display:none;}
  .success-msg.visible{display:block;}

  /* ‚îÄ‚îÄ ANALYTICS ‚îÄ‚îÄ */
  .analytics-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:10px;margin-bottom:20px;}
  .analytics-card{background:var(--s1);border:1px solid var(--border);border-radius:12px;padding:16px;}
  .ac-platform{display:inline-flex;align-items:center;gap:5px;font-size:11px;font-weight:500;padding:3px 8px;border-radius:4px;margin-bottom:12px;}
  .ac-offer{font-size:13px;font-weight:600;color:var(--white);margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .ac-url{font-size:11px;color:var(--muted2);font-family:'Geist Mono',monospace;margin-bottom:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .ac-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;}
  .ac-stat{background:var(--s2);border-radius:6px;padding:8px;text-align:center;}
  .ac-stat-val{font-size:14px;font-weight:600;color:var(--white);font-family:'Geist Mono',monospace;}
  .ac-stat-label{font-size:10px;color:var(--muted2);margin-top:2px;}
  .ac-meta{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;}
  .ac-chip{font-size:10px;padding:2px 8px;border-radius:4px;background:var(--s3);color:var(--muted2);font-family:'Geist Mono',monospace;}

  /* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
  .empty-state{padding:48px;text-align:center;}
  .empty-icon{font-size:32px;margin-bottom:12px;opacity:0.3;}
  .empty-title{font-size:14px;font-weight:500;color:var(--muted2);margin-bottom:6px;}
  .empty-sub{font-size:12px;color:var(--muted);}

  /* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
  @keyframes pulse{0%,100%{opacity:1;transform:scale(1);}50%{opacity:0.4;transform:scale(0.8);}}
  @keyframes fadeIn{from{opacity:0;transform:translateY(6px);}to{opacity:1;transform:translateY(0);}}
  .fade-in{animation:fadeIn 0.3s ease forwards;opacity:0;}

  @media(max-width:1100px){.stats-grid{grid-template-columns:repeat(2,1fr);}}
  @media(max-width:800px){.sidebar{display:none;}.main{margin-left:0;}.section-row{grid-template-columns:1fr;}.pixel-platforms{grid-template-columns:1fr;}}
</style>
</head>
<body>

<!-- LOGIN PAGE -->
<div class="login-page active" id="login-page">
  <div class="login-box">
    <div class="login-logo">
      <div class="login-logo-mark">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M10 2L17 6V14L10 18L3 14V6L10 2Z" fill="#080808"/>
        </svg>
      </div>
      <div class="login-logo-name">Network Tracker</div>
    </div>
    <div class="login-card">
      <!-- LOGIN FORM -->
      <div id="login-form">
        <div class="login-title">Welcome back</div>
        <div class="login-sub">Sign in to your account</div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input class="form-input" type="email" id="login-email" placeholder="you@example.com">
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input class="form-input" type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <div class="form-error" id="login-error"></div>
        <button class="btn-primary" onclick="login()">Sign in</button>
        <div class="login-switch">Don't have an account? <a onclick="showSignup()">Sign up</a></div>
      </div>
      <!-- SIGNUP FORM -->
      <div id="signup-form" style="display:none">
        <div class="login-title">Create account</div>
        <div class="login-sub">Get started with Network Tracker</div>
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <input class="form-input" type="text" id="signup-name" placeholder="Your name">
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input class="form-input" type="email" id="signup-email" placeholder="you@example.com">
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input class="form-input" type="password" id="signup-password" placeholder="Min 6 characters">
        </div>
        <div class="form-error" id="signup-error"></div>
        <button class="btn-primary" onclick="signup()">Create account</button>
        <div class="login-switch">Already have an account? <a onclick="showLogin()">Sign in</a></div>
      </div>
    </div>
  </div>
</div>

<!-- APP -->
<div class="app" id="app">
  <!-- SIDEBAR -->
  <nav class="sidebar">
    <div class="logo">
      <div class="logo-mark">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M8 1L14 4.5V11.5L8 15L2 11.5V4.5L8 1Z" fill="#080808"/>
        </svg>
      </div>
      <div class="logo-name">Network Tracker</div>
      <div class="logo-sub">v2.0.0</div>
    </div>
    <div class="nav">
      <div class="nav-section">Main</div>
      <button class="nav-item active" onclick="showPage('dashboard',this)">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="1" y="1" width="6" height="6" rx="1"/><rect x="9" y="1" width="6" height="6" rx="1"/><rect x="1" y="9" width="6" height="6" rx="1"/><rect x="9" y="9" width="6" height="6" rx="1"/></svg>
        Dashboard
        <div class="live-dot"></div>
      </button>
      <div class="nav-section">Platforms</div>
      <button class="nav-item" onclick="showPage('pixels-meta',this)">
        <div class="platform-color" style="background:var(--meta)"></div>
        Meta
      </button>
      <button class="nav-item" onclick="showPage('pixels-youtube',this)">
        <div class="platform-color" style="background:var(--yt)"></div>
        YouTube
      </button>
      <button class="nav-item" onclick="showPage('pixels-tiktok',this)">
        <div class="platform-color" style="background:var(--tt)"></div>
        TikTok
      </button>
      <div class="nav-section">Data</div>
      <button class="nav-item" onclick="showPage('orders',this)">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 4H14M4 8H12M6 12H10"/></svg>
        Orders
      </button>
      <button class="nav-item" onclick="showPage('analytics',this)">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12L5 8L8 10L11 5L14 8"/><path d="M2 2V14H14"/></svg>
        Analytics
      </button>
    </div>
    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-avatar" id="user-avatar">?</div>
        <div>
          <div class="user-name" id="user-name">Loading...</div>
          <div class="user-role" id="user-role">member</div>
        </div>
      </div>
      <button class="logout-btn" onclick="logout()">Sign out</button>
    </div>
  </nav>

  <!-- MAIN -->
  <div class="main">
    <div class="topbar">
      <div class="topbar-title" id="page-title">Dashboard</div>
      <div class="topbar-date" id="current-date"></div>
      <div class="refresh-btn" onclick="refreshPage()" title="Refresh">
        <svg width="13" height="13" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M13.5 8C13.5 11.04 11.04 13.5 8 13.5C4.96 13.5 2.5 11.04 2.5 8C2.5 4.96 4.96 2.5 8 2.5C9.74 2.5 11.3 3.28 12.36 4.5"/><path d="M10.5 2L13 4.5L10.5 7"/></svg>
      </div>
    </div>

    <div class="content">

      <!-- DASHBOARD PAGE -->
      <div class="page active" id="page-dashboard">
        <div class="stats-grid">
          <div class="stat-card fade-in">
            <div class="stat-label">Revenue Today</div>
            <div class="stat-value" id="revenue-today"><span class="currency">$</span>0.00</div>
            <div class="stat-change neutral" id="revenue-change">‚Äì</div>
          </div>
          <div class="stat-card fade-in">
            <div class="stat-label">Orders Today</div>
            <div class="stat-value" id="orders-today">0</div>
            <div class="stat-change neutral" id="orders-change">‚Äì</div>
          </div>
          <div class="stat-card fade-in">
            <div class="stat-label">Total Revenue</div>
            <div class="stat-value" id="revenue-total"><span class="currency">$</span>0.00</div>
            <div class="stat-change neutral" id="total-label">0 total orders</div>
          </div>
          <div class="stat-card fade-in">
            <div class="stat-label">Conversion Rate</div>
            <div class="stat-value" id="conv-rate">0%</div>
            <div class="stat-change neutral" id="conv-label">‚Äì</div>
          </div>
        </div>
        <div class="section-row">
          <div class="card">
            <div class="card-header">
              <div class="card-title">Revenue by Platform</div>
              <div class="card-badge">Today</div>
            </div>
            <div class="card-body">
              <div class="platform-list" id="platform-list">
                <div class="platform-row"><div class="platform-info"><div class="platform-dot" style="background:var(--meta)"></div><div class="platform-name">Meta</div></div><div class="bar-track"><div class="bar-fill" style="width:0%;background:var(--meta)"></div></div><div class="platform-amount">$0.00</div></div>
                <div class="platform-row"><div class="platform-info"><div class="platform-dot" style="background:var(--yt)"></div><div class="platform-name">YouTube</div></div><div class="bar-track"><div class="bar-fill" style="width:0%;background:var(--yt)"></div></div><div class="platform-amount">$0.00</div></div>
                <div class="platform-row"><div class="platform-info"><div class="platform-dot" style="background:var(--tt)"></div><div class="platform-name">TikTok</div></div><div class="bar-track"><div class="bar-fill" style="width:0%;background:var(--tt)"></div></div><div class="platform-amount">$0.00</div></div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-title">Conversion Rate</div>
              <div class="card-badge">Clicks ‚Üí Orders</div>
            </div>
            <div class="card-body">
              <div class="conv-big">
                <div class="conv-number" id="conv-big">0</div>
                <div class="conv-pct">%</div>
              </div>
              <div class="conv-desc" id="conv-desc">No data yet</div>
              <div class="conv-bar-label"><span>0%</span><span id="conv-bar-right">0%</span></div>
              <div class="conv-track"><div class="conv-fill" id="conv-fill" style="width:0%"></div></div>
            </div>
          </div>
        </div>
        <div class="table-card">
          <div class="card-header">
            <div class="card-title">Recent Orders</div>
            <div class="card-badge" id="recent-badge">0 today</div>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Transaction ID</th><th>Platform</th><th>Campaign</th><th>Payout</th><th>Pixels</th><th>Status</th><th>Time</th></tr></thead>
              <tbody id="dashboard-orders-tbody"><tr><td colspan="7"><div class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-title">No orders yet</div><div class="empty-sub">Orders will appear here as postbacks arrive</div></div></td></tr></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ORDERS PAGE -->
      <div class="page" id="page-orders">
        <div class="filters">
          <button class="filter-btn active" onclick="filterOrders('all',this)">All Time</button>
          <button class="filter-btn" onclick="filterOrders('today',this)">Today</button>
          <button class="filter-btn" onclick="filterOrders('yesterday',this)">Yesterday</button>
          <button class="filter-btn" onclick="filterOrders('7days',this)">Last 7 Days</button>
          <button class="filter-btn" onclick="filterOrders('30days',this)">Last 30 Days</button>
        </div>
        <div class="table-card">
          <div class="card-header">
            <div class="card-title">Orders</div>
            <div class="card-badge" id="orders-badge">Loading...</div>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Transaction ID</th><th>Platform</th><th>Offer</th><th>Campaign</th><th>Country</th><th>Device</th><th>Payout</th><th>Network</th><th>Time</th></tr></thead>
              <tbody id="orders-tbody"><tr><td colspan="9"><div class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-title">No orders yet</div></div></td></tr></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ANALYTICS PAGE -->
      <div class="page" id="page-analytics">
        <div class="filters">
          <button class="filter-btn active" onclick="filterAnalytics('30days',this)">Last 30 Days</button>
          <button class="filter-btn" onclick="filterAnalytics('today',this)">Today</button>
          <button class="filter-btn" onclick="filterAnalytics('yesterday',this)">Yesterday</button>
          <button class="filter-btn" onclick="filterAnalytics('7days',this)">Last 7 Days</button>
        </div>
        <div class="analytics-grid" id="analytics-grid">
          <div class="empty-state"><div class="empty-icon">üìä</div><div class="empty-title">No analytics data yet</div><div class="empty-sub">Data will appear once orders come in</div></div>
        </div>
      </div>

      <!-- PIXEL PAGES -->
      <div class="page" id="page-pixels-meta">
        <div id="pixel-form-meta"></div>
      </div>
      <div class="page" id="page-pixels-youtube">
        <div id="pixel-form-youtube"></div>
      </div>
      <div class="page" id="page-pixels-tiktok">
        <div id="pixel-form-tiktok"></div>
      </div>

    </div>
  </div>
</div>

<script>
  // ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
  let token = localStorage.getItem('tracker_token');
  let currentUser = null;
  let currentOrderPeriod = 'all';
  let currentAnalyticsPeriod = '30days';
  let currentPage = 'dashboard';

  const PLATFORM_CFG = {
    meta:    { color:'#0082fb', label:'Meta',    tagClass:'tag-meta', icon:'üìò' },
    facebook:{ color:'#0082fb', label:'Meta',    tagClass:'tag-meta', icon:'üìò' },
    youtube: { color:'#ff0000', label:'YouTube', tagClass:'tag-yt',   icon:'‚ñ∂Ô∏è' },
    tiktok:  { color:'#ff2d55', label:'TikTok',  tagClass:'tag-tt',   icon:'üéµ' },
    unknown: { color:'#888',    label:'Unknown', tagClass:'',         icon:'‚ùì' }
  };

  function getPlatform(s) {
    const v = (s||'').toLowerCase();
    if (v.includes('meta')||v.includes('facebook')||v.includes('fb')) return 'meta';
    if (v.includes('youtube')||v.includes('yt')||v.includes('google')) return 'youtube';
    if (v.includes('tiktok')||v.includes('tt')) return 'tiktok';
    return 'unknown';
  }

  function fmt(n) { return parseFloat(n||0).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}); }

  function timeAgo(d) {
    const diff = (Date.now()-new Date(d))/1000;
    if (diff<60) return 'just now';
    if (diff<3600) return `${Math.floor(diff/60)}m ago`;
    if (diff<86400) return `${Math.floor(diff/3600)}h ago`;
    return new Date(d).toLocaleDateString('en-US',{month:'short',day:'numeric'});
  }

  async function api(url, opts={}) {
    const res = await fetch(url, {
      ...opts,
      headers: { 'Content-Type':'application/json', 'Authorization':`Bearer ${token}`, ...opts.headers }
    });
    return res.json();
  }

  // ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ
  function showSignup() {
    document.getElementById('login-form').style.display = 'none';
    document.getElementById('signup-form').style.display = 'block';
  }

  function showLogin() {
    document.getElementById('signup-form').style.display = 'none';
    document.getElementById('login-form').style.display = 'block';
  }

  async function login() {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    const errEl = document.getElementById('login-error');
    errEl.classList.remove('visible');
    if (!email||!password) { errEl.textContent='Please fill in all fields'; errEl.classList.add('visible'); return; }
    const btn = event.target;
    btn.disabled = true; btn.textContent = 'Signing in...';
    const data = await api('/api/auth/login', { method:'POST', body: JSON.stringify({email,password}) });
    btn.disabled = false; btn.textContent = 'Sign in';
    if (data.error) { errEl.textContent = data.error; errEl.classList.add('visible'); return; }
    token = data.token;
    localStorage.setItem('tracker_token', token);
    currentUser = data.user;
    showApp();
  }

  async function signup() {
    const name = document.getElementById('signup-name').value;
    const email = document.getElementById('signup-email').value;
    const password = document.getElementById('signup-password').value;
    const errEl = document.getElementById('signup-error');
    errEl.classList.remove('visible');
    if (!name||!email||!password) { errEl.textContent='Please fill in all fields'; errEl.classList.add('visible'); return; }
    if (password.length < 6) { errEl.textContent='Password must be at least 6 characters'; errEl.classList.add('visible'); return; }
    const btn = event.target;
    btn.disabled = true; btn.textContent = 'Creating account...';
    const data = await api('/api/auth/signup', { method:'POST', body: JSON.stringify({name,email,password}) });
    btn.disabled = false; btn.textContent = 'Create account';
    if (data.error) { errEl.textContent = data.error; errEl.classList.add('visible'); return; }
    token = data.token;
    localStorage.setItem('tracker_token', token);
    currentUser = data.user;
    showApp();
  }

  function logout() {
    localStorage.removeItem('tracker_token');
    token = null; currentUser = null;
    document.getElementById('app').classList.remove('active');
    document.getElementById('login-page').classList.add('active');
  }

  function showApp() {
    document.getElementById('login-page').classList.remove('active');
    document.getElementById('app').classList.add('active');
    document.getElementById('user-name').textContent = currentUser.name || currentUser.email;
    document.getElementById('user-role').textContent = currentUser.role;
    document.getElementById('user-avatar').textContent = (currentUser.name||currentUser.email)[0].toUpperCase();
    document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'});
    loadDashboard();
    loadPixelSettings();
  }

  // ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
  function showPage(page, btn) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById('page-'+page).classList.add('active');
    if (btn) btn.classList.add('active');
    currentPage = page;

    const titles = { dashboard:'Dashboard', orders:'Orders', analytics:'Analytics', 'pixels-meta':'Meta ‚Äî Pixel Settings', 'pixels-youtube':'YouTube ‚Äî Pixel Settings', 'pixels-tiktok':'TikTok ‚Äî Pixel Settings' };
    document.getElementById('page-title').textContent = titles[page] || page;

    if (page === 'orders') loadOrders(currentOrderPeriod);
    if (page === 'analytics') loadAnalytics(currentAnalyticsPeriod);
    if (page.startsWith('pixels-')) renderPixelForm(page.replace('pixels-',''));
  }

  function refreshPage() {
    if (currentPage === 'dashboard') loadDashboard();
    else if (currentPage === 'orders') loadOrders(currentOrderPeriod);
    else if (currentPage === 'analytics') loadAnalytics(currentAnalyticsPeriod);
  }

  // ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ
  async function loadDashboard() {
    const stats = await api('/api/stats');
    if (stats.error) return;

    document.getElementById('revenue-today').innerHTML = `<span class="currency">$</span>${fmt(stats.revenue_today)}`;
    document.getElementById('orders-today').textContent = stats.orders_today || 0;
    document.getElementById('revenue-total').innerHTML = `<span class="currency">$</span>${fmt(stats.revenue_total)}`;
    document.getElementById('conv-rate').textContent = `${(stats.conversion_rate||0).toFixed(1)}%`;
    document.getElementById('conv-big').textContent = (stats.conversion_rate||0).toFixed(1);
    document.getElementById('conv-fill').style.width = `${Math.min((stats.conversion_rate||0)*5,100)}%`;
    document.getElementById('conv-bar-right').textContent = `${(stats.conversion_rate||0).toFixed(1)}%`;
    document.getElementById('conv-desc').textContent = `${stats.total_clicks||0} clicks ‚Üí ${stats.total_orders||0} orders`;
    document.getElementById('conv-label').textContent = `${stats.total_clicks||0} tracked clicks`;
    document.getElementById('total-label').textContent = `${stats.total_orders||0} total orders`;
    document.getElementById('recent-badge').textContent = `${stats.orders_today||0} today`;

    const rc = stats.revenue_change||0;
    const oc = stats.orders_change||0;
    document.getElementById('revenue-change').innerHTML = `<span class="${rc>=0?'up':'down'}">${rc>=0?'‚Üë':'‚Üì'} ${Math.abs(rc).toFixed(1)}% vs yesterday</span>`;
    document.getElementById('orders-change').innerHTML = `<span class="${oc>=0?'up':'down'}">${oc>=0?'‚Üë':'‚Üì'} ${Math.abs(oc)} vs yesterday</span>`;

    renderPlatforms(stats.by_platform||[]);

    const orders = await api('/api/orders?limit=8');
    renderOrdersTable(orders, 'dashboard-orders-tbody', true);
  }

  function renderPlatforms(platforms) {
    const total = platforms.reduce((s,p) => s+parseFloat(p.revenue||0), 0);
    const keys = ['meta','youtube','tiktok'];
    const map = {};
    platforms.forEach(p => { map[getPlatform(p.source)] = p; });

    document.getElementById('platform-list').innerHTML = keys.map(k => {
      const p = map[k]; const rev = p ? parseFloat(p.revenue||0) : 0;
      const pct = total > 0 ? (rev/total*100) : 0;
      const cfg = PLATFORM_CFG[k];
      return `<div class="platform-row">
        <div class="platform-info"><div class="platform-dot" style="background:${cfg.color}"></div><div class="platform-name">${cfg.label}</div></div>
        <div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:${cfg.color};opacity:0.8"></div></div>
        <div class="platform-amount">$${fmt(rev)}</div>
      </div>`;
    }).join('');
  }

  // ‚îÄ‚îÄ ORDERS ‚îÄ‚îÄ
  function filterOrders(period, btn) {
    currentOrderPeriod = period;
    document.querySelectorAll('#page-orders .filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    loadOrders(period);
  }

  async function loadOrders(period) {
    const url = period === 'all' ? '/api/orders?limit=100' : `/api/orders?limit=100&period=${period}`;
    const orders = await api(url);
    document.getElementById('orders-badge').textContent = `${Array.isArray(orders)?orders.length:0} orders`;
    renderOrdersTable(orders, 'orders-tbody', false);
  }

  function renderOrdersTable(orders, tbodyId, compact) {
    const tbody = document.getElementById(tbodyId);
    if (!orders || !orders.length) {
      tbody.innerHTML = `<tr><td colspan="${compact?7:9}"><div class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-title">No orders yet</div><div class="empty-sub">Orders will appear here as postbacks arrive</div></div></td></tr>`;
      return;
    }
    tbody.innerHTML = orders.map(o => {
      const pk = getPlatform(o.traffic_source);
      const cfg = PLATFORM_CFG[pk];
      const pixels = `<div class="pixel-cell"><div class="pixel-dot ${o.pixel_fired_fb?'pixel-on':'pixel-off'}">FB</div><div class="pixel-dot ${o.pixel_fired_tt?'pixel-on':'pixel-off'}">TT</div></div>`;
      const extra = compact ? '' : `<td style="color:var(--muted2);font-size:12px">${o.offer_name||'‚Äì'}</td><td style="color:var(--muted2);font-size:12px">${o.campaign_id||'‚Äì'}</td><td style="color:var(--muted2);font-size:12px">${o.country||'‚Äì'}</td><td style="color:var(--muted2);font-size:12px">${o.device_type||'‚Äì'}</td>`;
      return `<tr>
        <td class="id-cell">${(o.transaction_id||'‚Äì').substring(0,16)}...</td>
        <td><span class="platform-tag ${cfg.tagClass}"><span class="tag-dot"></span>${cfg.label}</span></td>
        ${extra}
        <td class="payout-cell">+$${fmt(o.payout)}</td>
        ${compact ? `<td>${pixels}</td>` : `<td style="color:var(--muted2);font-size:12px">${o.network||'‚Äì'}</td>`}
        <td><span class="status-badge">Confirmed</span></td>
        <td class="time-cell">${timeAgo(o.received_at)}</td>
      </tr>`;
    }).join('');
  }

  // ‚îÄ‚îÄ ANALYTICS ‚îÄ‚îÄ
  function filterAnalytics(period, btn) {
    currentAnalyticsPeriod = period;
    document.querySelectorAll('#page-analytics .filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    loadAnalytics(period);
  }

  async function loadAnalytics(period) {
    const data = await api(`/api/analytics?period=${period}`);
    const grid = document.getElementById('analytics-grid');
    if (!data || !data.length) {
      grid.innerHTML = `<div class="empty-state"><div class="empty-icon">üìä</div><div class="empty-title">No data for this period</div><div class="empty-sub">Try a longer time range</div></div>`;
      return;
    }
    grid.innerHTML = data.map(row => {
      const pk = getPlatform(row.platform);
      const cfg = PLATFORM_CFG[pk];
      return `<div class="analytics-card fade-in">
        <div class="ac-platform" style="background:${cfg.color}20;color:${cfg.color};border:1px solid ${cfg.color}30">
          <span class="tag-dot" style="background:${cfg.color}"></span> ${cfg.label}
        </div>
        <div class="ac-offer">${row.offer_name||'Unknown Offer'}</div>
        <div class="ac-url">${row.landing_page_url||'‚Äì'}</div>
        <div class="ac-stats">
          <div class="ac-stat"><div class="ac-stat-val">$${fmt(row.revenue)}</div><div class="ac-stat-label">Revenue</div></div>
          <div class="ac-stat"><div class="ac-stat-val">${row.sales}</div><div class="ac-stat-label">Sales</div></div>
          <div class="ac-stat"><div class="ac-stat-val">$${fmt(row.avg_payout)}</div><div class="ac-stat-label">Avg</div></div>
        </div>
        <div class="ac-meta">
          ${row.ad_creative ? `<span class="ac-chip">üé® ${row.ad_creative}</span>` : ''}
          ${row.country ? `<span class="ac-chip">üåç ${row.country}</span>` : ''}
          ${row.device_type ? `<span class="ac-chip">üì± ${row.device_type}</span>` : ''}
        </div>
      </div>`;
    }).join('');
  }

  // ‚îÄ‚îÄ PIXEL SETTINGS ‚îÄ‚îÄ
  let pixelData = {};

  async function loadPixelSettings() {
    const data = await api('/api/pixels');
    if (Array.isArray(data)) {
      data.forEach(p => { pixelData[p.platform] = p; });
    }
  }

  function renderPixelForm(platform) {
    const p = pixelData[platform] || {};
    const cfg = PLATFORM_CFG[platform] || PLATFORM_CFG.unknown;
    const labels = {
      meta:    { id:'Pixel ID', token:'Access Token (CAPI)', idph:'e.g. 1234567890123456', tokenph:'e.g. EAAxxxxxx...' },
      youtube: { id:'Conversion ID', token:'Conversion Label', idph:'e.g. AW-123456789', tokenph:'e.g. abcDEFghij' },
      tiktok:  { id:'Pixel ID', token:'Access Token', idph:'e.g. CXXXXXXXXXXXXXX', tokenph:'e.g. xxxxxx...' }
    };
    const l = labels[platform] || labels.meta;

    document.getElementById(`pixel-form-${platform}`).innerHTML = `
      <div style="margin-bottom:20px">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
          <div style="width:44px;height:44px;border-radius:12px;background:${cfg.color}20;border:1px solid ${cfg.color}30;display:flex;align-items:center;justify-content:center;font-size:20px">${cfg.icon}</div>
          <div>
            <div style="font-size:18px;font-weight:700;color:var(--white)">${cfg.label}</div>
            <div style="font-size:12px;color:var(--muted2)">Pixel & API Configuration</div>
          </div>
        </div>
      </div>
      <div class="card" style="margin-bottom:16px">
        <div class="card-header">
          <div class="card-title">Connection Status</div>
          <div class="card-badge" style="${p.pixel_id?'color:var(--green);background:var(--green-d);border-color:var(--green-b)':''}">
            ${p.pixel_id ? '‚óè Connected' : '‚óã Not configured'}
          </div>
        </div>
        <div class="card-body">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">${l.id}</label>
              <input class="form-input" type="text" id="${platform}-pixel-id" value="${p.pixel_id||''}" placeholder="${l.idph}">
            </div>
            <div class="form-group">
              <label class="form-label">${l.token}</label>
              <input class="form-input" type="text" id="${platform}-access-token" value="${p.access_token||''}" placeholder="${l.tokenph}">
            </div>
          </div>
          <button class="btn-save" onclick="savePixel('${platform}')">Save & Connect</button>
          <button class="btn-secondary" onclick="testPixel('${platform}')">Test Connection</button>
          <div class="success-msg" id="${platform}-success">‚úì Saved successfully ‚Äî your pixel is now connected</div>
        </div>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title">How to find your credentials</div></div>
        <div class="card-body" style="font-size:13px;color:var(--muted2);line-height:1.8">
          ${platform === 'meta' ? `
            <b style="color:var(--text)">Pixel ID:</b> Facebook Events Manager ‚Üí Your Dataset ‚Üí Settings ‚Üí Dataset ID<br>
            <b style="color:var(--text)">Access Token:</b> Events Manager ‚Üí Your Dataset ‚Üí Settings ‚Üí Conversions API ‚Üí Generate Access Token
          ` : platform === 'youtube' ? `
            <b style="color:var(--text)">Conversion ID:</b> Google Ads ‚Üí Tools ‚Üí Conversions ‚Üí your conversion ‚Üí Tag setup ‚Üí Conversion ID<br>
            <b style="color:var(--text)">Conversion Label:</b> Same page ‚Äî Conversion Label (below Conversion ID)
          ` : `
            <b style="color:var(--text)">Pixel ID:</b> TikTok Ads Manager ‚Üí Assets ‚Üí Events ‚Üí Web Events ‚Üí your pixel<br>
            <b style="color:var(--text)">Access Token:</b> Same page ‚Üí Events API tab ‚Üí Generate Access Token
          `}
        </div>
      </div>`;
  }

  async function savePixel(platform) {
    const pixel_id = document.getElementById(`${platform}-pixel-id`).value;
    const access_token = document.getElementById(`${platform}-access-token`).value;
    const data = await api('/api/pixels', {
      method: 'POST',
      body: JSON.stringify({ platform, pixel_id, access_token, enabled: true })
    });
    if (data.id) {
      pixelData[platform] = data;
      const msg = document.getElementById(`${platform}-success`);
      msg.classList.add('visible');
      setTimeout(() => { msg.classList.remove('visible'); renderPixelForm(platform); }, 3000);
    }
  }

  async function testPixel(platform) {
    alert(`Test postback sent to your server for ${PLATFORM_CFG[platform]?.label||platform}. Check your Railway deploy logs to see if the pixel fired correctly.`);
  }

  // ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
  async function init() {
    if (token) {
      const me = await api('/api/auth/me');
      if (me.id) { currentUser = me; showApp(); }
      else { localStorage.removeItem('tracker_token'); }
    }
    document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'});
  }

  init();
  setInterval(() => { if (currentPage==='dashboard') loadDashboard(); }, 30000);
</script>
</body>
</html>