<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Network Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600;700&family=Geist+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root{--bg:#080808;--s1:#0f0f0f;--s2:#141414;--s3:#1c1c1c;--border:#222;--border2:#2a2a2a;--text:#e8e8e8;--muted:#555;--muted2:#888;--white:#fff;--green:#00d084;--green-d:#00d08415;--green-b:#00d08430;--meta:#0082fb;--meta-d:#0082fb15;--tt:#ff2d55;--tt-d:#ff2d5515;--snap:#b8b000;--snap-d:#FFFC0015;--google:#4285f4;--google-d:#4285f415;--red:#ff4d4d;--red-d:#ff4d4d15;--red-b:#ff4d4d30;--orange:#ff9500;--sw:228px;}
[data-theme="light"]{--bg:#f4f4f4;--s1:#fff;--s2:#f0f0f0;--s3:#e8e8e8;--border:#e0e0e0;--border2:#d0d0d0;--text:#1a1a1a;--muted:#bbb;--muted2:#777;--white:#111;}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:'Geist',sans-serif;min-height:100vh;-webkit-font-smoothing:antialiased;transition:background .2s,color .2s;}

.login-page{display:none;min-height:100vh;align-items:center;justify-content:center;}
.login-page.active{display:flex;}
.lbox{width:100%;max-width:420px;padding:20px;}
.llogo{display:flex;align-items:center;gap:12px;margin-bottom:36px;justify-content:center;}
.llogo-mark{width:40px;height:40px;background:var(--green);border-radius:10px;display:flex;align-items:center;justify-content:center;}
.llogo-name{font-size:19px;font-weight:700;color:var(--white);}
.lcard{background:var(--s1);border:1px solid var(--border);border-radius:16px;padding:30px;}
.ltitle{font-size:21px;font-weight:700;color:var(--white);margin-bottom:4px;}
.lsub{font-size:13px;color:var(--muted2);margin-bottom:22px;}
.fg{margin-bottom:13px;}
.fl{font-size:11px;color:var(--muted2);margin-bottom:5px;display:block;font-weight:500;}
.fi{width:100%;background:var(--s2);border:1px solid var(--border2);border-radius:8px;padding:10px 13px;font-size:13px;color:var(--text);font-family:'Geist',sans-serif;outline:none;transition:border-color .15s;}
.fi:focus{border-color:var(--green);}
.fi::placeholder{color:var(--muted);}
select.fi{cursor:pointer;}
.bp{width:100%;background:var(--green);color:#000;border:none;border-radius:8px;padding:11px;font-size:13px;font-weight:600;cursor:pointer;font-family:'Geist',sans-serif;margin-top:6px;}
.bp:hover{opacity:.88;}
.bp:disabled{opacity:.5;cursor:not-allowed;}
.lswitch{text-align:center;margin-top:16px;font-size:12px;color:var(--muted2);}
.lswitch a{color:var(--green);cursor:pointer;}
.ferr{font-size:11px;color:var(--red);margin-top:5px;display:none;}
.ferr.v{display:block;}

.app{display:none;}
.app.active{display:flex;min-height:100vh;}

.sidebar{position:fixed;left:0;top:0;bottom:0;width:var(--sw);background:var(--s1);border-right:1px solid var(--border);display:flex;flex-direction:column;padding:20px 0;z-index:100;transition:transform .25s;}
.logo{padding:0 16px 18px;border-bottom:1px solid var(--border);margin-bottom:14px;}
.logo-mark{width:28px;height:28px;background:var(--green);border-radius:7px;display:flex;align-items:center;justify-content:center;margin-bottom:7px;}
.logo-name{font-size:13px;font-weight:700;color:var(--white);}
.logo-sub{font-size:10px;color:var(--muted);font-family:'Geist Mono',monospace;}
.nav{padding:0 7px;flex:1;overflow-y:auto;}
.ns{font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);padding:11px 10px 5px;font-family:'Geist Mono',monospace;}
.ni{display:flex;align-items:center;gap:8px;padding:7px 10px;border-radius:7px;font-size:12px;color:var(--muted2);cursor:pointer;transition:all .15s;margin-bottom:1px;font-weight:500;border:none;background:none;width:100%;text-align:left;}
.ni:hover{background:var(--s2);color:var(--text);}
.ni.active{background:var(--s2);color:var(--white);}
.ni-icon{width:13px;height:13px;flex-shrink:0;opacity:.6;}
.ni.active .ni-icon,.ni:hover .ni-icon{opacity:1;}
.ldot{width:5px;height:5px;background:var(--green);border-radius:50%;margin-left:auto;animation:pulse 2s infinite;}
.pdot{width:6px;height:6px;border-radius:50%;flex-shrink:0;}
.sf{padding:13px 16px 0;border-top:1px solid var(--border);}
.uinfo{display:flex;align-items:center;gap:8px;margin-bottom:9px;}
.uav{width:25px;height:25px;border-radius:50%;background:var(--green-d);border:1px solid var(--green-b);display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:var(--green);flex-shrink:0;}
.uname{font-size:11px;font-weight:500;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.urole{font-size:10px;color:var(--muted);font-family:'Geist Mono',monospace;}
.fa{display:flex;align-items:center;gap:8px;}
.lout{font-size:11px;color:var(--muted);background:none;border:none;cursor:pointer;font-family:'Geist',sans-serif;padding:0;}
.lout:hover{color:var(--red);}
.ib{width:24px;height:24px;border-radius:6px;border:1px solid var(--border);background:var(--s2);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:11px;color:var(--muted2);}
.ib:hover{border-color:var(--green);color:var(--green);}

.mbar{display:none;position:fixed;top:0;left:0;right:0;height:50px;background:var(--s1);border-bottom:1px solid var(--border);z-index:200;align-items:center;padding:0 14px;gap:10px;}
.hbg{width:30px;height:30px;border-radius:7px;border:1px solid var(--border);background:var(--s2);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3.5px;cursor:pointer;padding:7px;}
.hbg span{display:block;width:13px;height:1.5px;background:var(--muted2);border-radius:1px;}
.mtitle{font-size:13px;font-weight:600;color:var(--white);}
.ov{display:none;position:fixed;inset:0;background:#00000060;z-index:99;}
.ov.v{display:block;}

.main{margin-left:var(--sw);flex:1;display:flex;flex-direction:column;}
.topbar{height:50px;border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 22px;gap:9px;background:var(--bg);position:sticky;top:0;z-index:50;}
.tb-title{font-size:13px;font-weight:600;color:var(--white);flex:1;}
.tb-date{font-size:11px;color:var(--muted2);font-family:'Geist Mono',monospace;}
.content{padding:22px;flex:1;}

.page{display:none;}
.page.active{display:block;animation:fadeIn .2s ease;}

.sg{display:grid;grid-template-columns:repeat(4,1fr);gap:9px;margin-bottom:16px;}
.sc{background:var(--s1);border:1px solid var(--border);border-radius:10px;padding:15px;}
.slabel{font-size:10px;color:var(--muted2);font-weight:500;margin-bottom:8px;}
.sval{font-size:22px;font-weight:700;color:var(--white);letter-spacing:-.8px;line-height:1;margin-bottom:5px;font-variant-numeric:tabular-nums;}
.sval .cur{font-size:12px;font-weight:500;color:var(--muted2);}
.schange{font-size:10px;font-family:'Geist Mono',monospace;}
.up{color:var(--green);}.down{color:var(--red);}.neu{color:var(--muted2);}

.sr{display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:16px;}
.card{background:var(--s1);border:1px solid var(--border);border-radius:10px;overflow:hidden;}
.ch{padding:13px 15px 10px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;}
.ct{font-size:12px;font-weight:600;color:var(--white);}
.cb{font-size:10px;font-family:'Geist Mono',monospace;color:var(--muted2);background:var(--s2);border:1px solid var(--border);padding:2px 7px;border-radius:4px;}
.cbody{padding:13px 15px;}

.pl{display:flex;flex-direction:column;gap:10px;}
.pr{display:grid;grid-template-columns:80px 1fr 60px;align-items:center;gap:9px;}
.pi{display:flex;align-items:center;gap:6px;}
.pname{font-size:11px;font-weight:500;color:var(--text);}
.bt{height:3px;background:var(--s3);border-radius:2px;overflow:hidden;}
.bf{height:100%;border-radius:2px;transition:width 1s cubic-bezier(.4,0,.2,1);}
.pamt{font-size:11px;font-weight:600;color:var(--white);text-align:right;font-family:'Geist Mono',monospace;}

.cvb{display:flex;align-items:flex-end;gap:5px;margin-bottom:9px;}
.cvn{font-size:38px;font-weight:700;color:var(--white);letter-spacing:-2px;line-height:1;}
.cvp{font-size:15px;color:var(--muted2);margin-bottom:3px;}
.cvd{font-size:11px;color:var(--muted2);margin-bottom:11px;}
.cvbl{display:flex;justify-content:space-between;font-size:10px;color:var(--muted2);font-family:'Geist Mono',monospace;margin-bottom:5px;}
.cvt{height:4px;background:var(--s3);border-radius:2px;overflow:hidden;}
.cvf{height:100%;background:linear-gradient(90deg,var(--green),#00ffaa);border-radius:2px;transition:width 1.2s cubic-bezier(.4,0,.2,1);}

.filters{display:flex;align-items:center;gap:6px;margin-bottom:13px;flex-wrap:wrap;}
.fb{padding:5px 11px;border-radius:7px;border:1px solid var(--border);background:var(--s1);color:var(--muted2);font-size:11px;font-weight:500;cursor:pointer;font-family:'Geist',sans-serif;transition:all .15s;}
.fb:hover{border-color:var(--border2);color:var(--text);}
.fb.active{background:var(--green-d);border-color:var(--green-b);color:var(--green);}

.sbar{display:flex;align-items:center;gap:8px;margin-bottom:13px;}
.si{flex:1;background:var(--s1);border:1px solid var(--border);border-radius:8px;padding:8px 12px;font-size:12px;color:var(--text);font-family:'Geist',sans-serif;outline:none;transition:border-color .15s;}
.si:focus{border-color:var(--green);}
.si::placeholder{color:var(--muted);}
.eb{padding:7px 13px;border-radius:8px;border:1px solid var(--border);background:var(--s1);color:var(--muted2);font-size:11px;font-weight:500;cursor:pointer;font-family:'Geist',sans-serif;white-space:nowrap;}
.eb:hover{border-color:var(--green);color:var(--green);}

.tc{background:var(--s1);border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:16px;}
.tw{overflow-x:auto;}
table{width:100%;border-collapse:collapse;}
thead th{padding:9px 12px;font-size:10px;font-weight:500;color:var(--muted2);text-align:left;border-bottom:1px solid var(--border);font-family:'Geist Mono',monospace;letter-spacing:.5px;text-transform:uppercase;white-space:nowrap;}
tbody tr{border-bottom:1px solid var(--border);transition:background .1s;}
tbody tr:last-child{border-bottom:none;}
tbody tr:hover{background:var(--s2);}
tbody td{padding:10px 12px;font-size:11px;white-space:nowrap;}
.ptag{display:inline-flex;align-items:center;gap:4px;font-size:10px;font-weight:500;padding:2px 7px;border-radius:4px;}
.tag-meta{background:var(--meta-d);color:var(--meta);border:1px solid #0082fb25;}
.tag-tt{background:var(--tt-d);color:var(--tt);border:1px solid #ff2d5525;}
.tag-snap{background:#FFFC0015;color:var(--snap);border:1px solid #FFFC0030;}
.tag-google{background:var(--google-d);color:var(--google);border:1px solid #4285f425;}
.tdot{width:4px;height:4px;border-radius:50%;background:currentColor;}
.pc{font-weight:600;color:var(--green);font-family:'Geist Mono',monospace;}
.tc2{font-family:'Geist Mono',monospace;font-size:10px;color:var(--muted2);}
.ic{font-family:'Geist Mono',monospace;font-size:10px;color:var(--muted2);}
.pxc{display:flex;gap:3px;}
.pxd{width:15px;height:15px;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:7px;font-weight:700;}
.px-on{background:var(--green-d);color:var(--green);border:1px solid var(--green-b);}
.px-off{background:var(--s3);color:var(--muted);border:1px solid var(--border);}

.pbh{background:var(--s1);border:1px solid var(--border);border-radius:10px;padding:22px;margin-bottom:13px;}
.pburl{background:var(--s2);border:1px solid var(--border2);border-radius:8px;padding:13px 15px;font-family:'Geist Mono',monospace;font-size:11px;color:var(--green);word-break:break-all;line-height:1.8;margin-bottom:11px;}
.cpbtn{display:inline-flex;align-items:center;gap:6px;padding:8px 15px;border-radius:8px;border:1px solid var(--green-b);background:var(--green-d);color:var(--green);font-size:11px;font-weight:600;cursor:pointer;font-family:'Geist',sans-serif;}
.cpbtn:hover{background:var(--green);color:#000;}
.cpsuc{font-size:11px;color:var(--green);margin-left:10px;opacity:0;transition:opacity .3s;}
.cpsuc.v{opacity:1;}
.mt{width:100%;border-collapse:collapse;margin-top:14px;}
.mt td{padding:7px 11px;font-size:11px;border-bottom:1px solid var(--border);}
.mt tr:last-child td{border-bottom:none;}
.mt td:first-child{font-family:'Geist Mono',monospace;color:var(--green);width:180px;}
.mt td:last-child{color:var(--muted2);}

.nc{background:var(--s1);border:1px solid var(--border);border-radius:10px;padding:22px;margin-bottom:13px;}
.fr{display:grid;grid-template-columns:1fr 1fr;gap:11px;margin-bottom:13px;}
.bsave{background:var(--green);color:#000;border:none;border-radius:7px;padding:8px 17px;font-size:12px;font-weight:600;cursor:pointer;font-family:'Geist',sans-serif;}
.bsave:hover{opacity:.88;}
.bsec{background:var(--s2);color:var(--text);border:1px solid var(--border2);border-radius:7px;padding:8px 17px;font-size:12px;font-weight:500;cursor:pointer;font-family:'Geist',sans-serif;margin-left:8px;}
.smsg{font-size:11px;color:var(--green);margin-top:8px;display:none;}
.smsg.v{display:block;}
.errmsg{font-size:11px;color:var(--red);margin-top:8px;display:none;}
.errmsg.v{display:block;}

.px-list{display:flex;flex-direction:column;gap:8px;margin-bottom:14px;}
.px-item{background:var(--s2);border:1px solid var(--border);border-radius:8px;padding:12px 14px;display:flex;align-items:center;gap:12px;}
.px-name{font-size:12px;font-weight:600;color:var(--white);}
.px-id{font-size:10px;color:var(--muted2);font-family:'Geist Mono',monospace;margin-top:2px;}
.px-del{padding:4px 10px;border-radius:6px;border:1px solid var(--red-b);background:var(--red-d);color:var(--red);font-size:10px;cursor:pointer;font-family:'Geist',sans-serif;}
.px-add{background:var(--s1);border:1px solid var(--border2);border-radius:8px;padding:14px 15px;margin-top:12px;}
.px-add-title{font-size:12px;font-weight:600;color:var(--white);margin-bottom:12px;}

.rg{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:9px;margin-bottom:16px;}
.rc{background:var(--s1);border:1px solid var(--border);border-radius:10px;padding:15px;}
.ro{font-size:12px;font-weight:600;color:var(--white);margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.rp{display:inline-flex;align-items:center;gap:4px;font-size:10px;font-weight:500;padding:2px 7px;border-radius:4px;margin-bottom:11px;}
.rs{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:9px;}
.rst{background:var(--s2);border-radius:6px;padding:7px;text-align:center;}
.rsv{font-size:12px;font-weight:600;font-family:'Geist Mono',monospace;}
.rsl{font-size:9px;color:var(--muted2);margin-top:2px;}
.rprofit{padding:7px 10px;border-radius:7px;text-align:center;font-size:12px;font-weight:700;font-family:'Geist Mono',monospace;}
.rprofit.pos{background:var(--green-d);color:var(--green);border:1px solid var(--green-b);}
.rprofit.neg{background:var(--red-d);color:var(--red);border:1px solid var(--red-b);}
.rprofit.neu2{background:var(--s3);color:var(--muted2);border:1px solid var(--border);}

.cmr{display:grid;grid-template-columns:1fr 70px 70px 70px 80px;align-items:center;gap:9px;padding:9px 0;border-bottom:1px solid var(--border);}
.cmr:last-child{border-bottom:none;}
.cmc{font-size:11px;font-weight:500;color:var(--white);}
.cma{font-size:10px;color:var(--muted2);font-family:'Geist Mono',monospace;margin-top:2px;}
.cmn{font-size:11px;font-weight:600;text-align:right;font-family:'Geist Mono',monospace;}

.ag{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:9px;margin-bottom:16px;}
.acard{background:var(--s1);border:1px solid var(--border);border-radius:10px;padding:14px;}
.apl{display:inline-flex;align-items:center;gap:4px;font-size:10px;font-weight:500;padding:2px 7px;border-radius:4px;margin-bottom:9px;}
.ao{font-size:12px;font-weight:600;color:var(--white);margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.au{font-size:10px;color:var(--muted2);font-family:'Geist Mono',monospace;margin-bottom:9px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.as2{display:grid;grid-template-columns:1fr 1fr 1fr;gap:5px;}
.ast{background:var(--s2);border-radius:5px;padding:6px;text-align:center;}
.asv{font-size:12px;font-weight:600;color:var(--white);font-family:'Geist Mono',monospace;}
.asl{font-size:9px;color:var(--muted2);margin-top:2px;}
.am{display:flex;gap:4px;margin-top:8px;flex-wrap:wrap;}
.achip{font-size:9px;padding:2px 6px;border-radius:3px;background:var(--s3);color:var(--muted2);font-family:'Geist Mono',monospace;}

.admin-panel{background:linear-gradient(135deg,#00d08410,#00d08405);border:1px solid var(--green-b);border-radius:10px;padding:20px;margin-bottom:16px;}
.admin-badge{display:inline-flex;align-items:center;gap:6px;font-size:10px;font-weight:600;color:var(--green);background:var(--green-d);border:1px solid var(--green-b);padding:3px 10px;border-radius:5px;margin-bottom:14px;font-family:'Geist Mono',monospace;letter-spacing:1px;}
.user-cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:8px;margin-bottom:16px;}
.user-card{background:var(--s1);border:1px solid var(--border);border-radius:9px;padding:13px;cursor:pointer;transition:all .2s;}
.user-card:hover,.user-card.selected{border-color:var(--green-b);background:var(--green-d);}
.uc-av{width:30px;height:30px;border-radius:50%;background:var(--s3);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--green);margin-bottom:8px;}
.uc-name{font-size:12px;font-weight:600;color:var(--white);margin-bottom:2px;}
.uc-email{font-size:10px;color:var(--muted2);margin-bottom:6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.uc-role{font-size:9px;font-family:'Geist Mono',monospace;padding:2px 6px;border-radius:4px;display:inline-block;}
.role-admin{background:var(--green-d);color:var(--green);border:1px solid var(--green-b);}
.role-member{background:var(--s3);color:var(--muted2);border:1px solid var(--border);}
.user-detail{background:var(--s1);border:1px solid var(--border);border-radius:10px;padding:20px;}
.ud-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px;}
.ud-name{font-size:15px;font-weight:700;color:var(--white);}
.ud-email{font-size:11px;color:var(--muted2);}
.ud-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:14px;}
.ud-stat{background:var(--s2);border:1px solid var(--border);border-radius:8px;padding:11px;text-align:center;}
.ud-stat-val{font-size:17px;font-weight:700;color:var(--white);font-family:'Geist Mono',monospace;}
.ud-stat-label{font-size:10px;color:var(--muted2);margin-top:3px;}

.faq-section-label{font-size:11px;font-weight:700;color:var(--green);letter-spacing:2px;text-transform:uppercase;font-family:'Geist Mono',monospace;margin:18px 0 8px;display:block;}
.faq-list{display:flex;flex-direction:column;gap:6px;}
.faq-item{background:var(--s1);border:1px solid var(--border);border-radius:9px;overflow:hidden;}
.faq-q{padding:13px 15px;font-size:12px;font-weight:600;color:var(--white);cursor:pointer;display:flex;align-items:center;justify-content:space-between;user-select:none;}
.faq-q:hover{background:var(--s2);}
.faq-arrow{font-size:10px;color:var(--muted2);transition:transform .2s;}
.faq-item.open .faq-arrow{transform:rotate(180deg);}
.faq-a{display:none;padding:0 15px 13px;font-size:12px;color:var(--muted2);line-height:1.9;border-top:1px solid var(--border);}
.faq-item.open .faq-a{display:block;}
.faq-a code{font-family:'Geist Mono',monospace;background:var(--s3);padding:1px 5px;border-radius:3px;font-size:11px;color:var(--green);}

.mo{display:none;position:fixed;inset:0;background:#00000070;z-index:300;align-items:center;justify-content:center;}
.mo.v{display:flex;}
.modal{background:var(--s1);border:1px solid var(--border);border-radius:14px;padding:22px;width:100%;max-width:420px;margin:20px;}
.modal-title{font-size:14px;font-weight:700;color:var(--white);margin-bottom:3px;}
.modal-sub{font-size:11px;color:var(--muted2);margin-bottom:16px;}
.mf{display:flex;gap:8px;margin-top:14px;}
.bcancel{background:var(--s2);color:var(--muted2);border:1px solid var(--border);border-radius:7px;padding:8px 15px;font-size:11px;cursor:pointer;font-family:'Geist',sans-serif;}

.empty{padding:36px;text-align:center;}
.eicon{font-size:26px;margin-bottom:9px;opacity:.3;}
.etitle{font-size:12px;font-weight:500;color:var(--muted2);margin-bottom:4px;}
.esub{font-size:11px;color:var(--muted);}

@keyframes pulse{0%,100%{opacity:1;}50%{opacity:.4;}}
@keyframes fadeIn{from{opacity:0;transform:translateY(4px);}to{opacity:1;transform:translateY(0);}}
@media(max-width:900px){.sg{grid-template-columns:repeat(2,1fr);}.sr{grid-template-columns:1fr;}.fr{grid-template-columns:1fr;}.ud-stats{grid-template-columns:repeat(2,1fr);}}
@media(max-width:680px){.sidebar{transform:translateX(-100%);}.sidebar.open{transform:translateX(0);}.main{margin-left:0;padding-top:50px;}.mbar{display:flex;}.topbar{display:none;}.sg{grid-template-columns:1fr 1fr;}.content{padding:14px;}.cmr{grid-template-columns:1fr 55px 55px;}}
</style>
</head>
<body>

<div class="login-page active" id="login-page">
  <div class="lbox">
    <div class="llogo">
      <div class="llogo-mark"><svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M10 2L17 6V14L10 18L3 14V6L10 2Z" fill="#080808"/></svg></div>
      <div class="llogo-name">Network Tracker</div>
    </div>
    <div class="lcard">
      <div id="lf">
        <div class="ltitle">Welcome back</div><div class="lsub">Sign in to your account</div>
        <div class="fg"><label class="fl">Email</label><input class="fi" type="email" id="le" placeholder="you@example.com"></div>
        <div class="fg"><label class="fl">Password</label><input class="fi" type="password" id="lp" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter')login()"></div>
        <div class="ferr" id="lerr"></div>
        <button class="bp" onclick="login()">Sign in</button>
        <div class="lswitch">No account? <a onclick="showSU()">Sign up</a></div>
      </div>
      <div id="suf" style="display:none">
        <div class="ltitle">Create account</div><div class="lsub">First account = admin. Others = member.</div>
        <div class="fg"><label class="fl">Full Name</label><input class="fi" type="text" id="sn" placeholder="Your name"></div>
        <div class="fg"><label class="fl">Email</label><input class="fi" type="email" id="se" placeholder="you@example.com"></div>
        <div class="fg"><label class="fl">Password</label><input class="fi" type="password" id="sp" placeholder="Min 6 characters"></div>
        <div class="ferr" id="serr"></div>
        <button class="bp" onclick="signup()">Create account</button>
        <div class="lswitch">Have an account? <a onclick="showLI()">Sign in</a></div>
      </div>
    </div>
  </div>
</div>

<div class="app" id="app">
  <div class="mbar">
    <div class="hbg" onclick="toggleSB()"><span></span><span></span><span></span></div>
    <div class="mtitle" id="mtitle">Dashboard</div>
    <div class="ib" onclick="toggleTheme()" style="margin-left:auto" id="mtheme">üåô</div>
  </div>
  <div class="ov" id="ov" onclick="toggleSB()"></div>

  <nav class="sidebar" id="sidebar">
    <div class="logo">
      <div class="logo-mark"><svg width="13" height="13" viewBox="0 0 16 16" fill="none"><path d="M8 1L14 4.5V11.5L8 15L2 11.5V4.5L8 1Z" fill="#080808"/></svg></div>
      <div class="logo-name">Network Tracker</div>
      <div class="logo-sub">v4.0.0</div>
    </div>
    <div class="nav">
      <div class="ns">Main</div>
      <button class="ni active" onclick="gp('dashboard',this)">
        <svg class="ni-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="1" y="1" width="6" height="6" rx="1"/><rect x="9" y="1" width="6" height="6" rx="1"/><rect x="1" y="9" width="6" height="6" rx="1"/><rect x="9" y="9" width="6" height="6" rx="1"/></svg>
        Dashboard <div class="ldot"></div>
      </button>
      <button class="ni admin-only" id="nav-admin" style="display:none" onclick="gp('admin',this)">
        <svg class="ni-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="5" r="3"/><path d="M2 14c0-3.31 2.69-6 6-6s6 2.69 6 6"/></svg>
        Team & Users
      </button>
      <div class="ns">Platforms</div>
      <button class="ni" onclick="gp('pixels-meta',this)"><div class="pdot" style="background:#0082fb"></div>Meta</button>
      <button class="ni" onclick="gp('pixels-tiktok',this)"><div class="pdot" style="background:#ff2d55"></div>TikTok</button>
      <button class="ni" onclick="gp('pixels-google',this)"><div class="pdot" style="background:#4285f4"></div>Google</button>
      <button class="ni" onclick="gp('pixels-snapchat',this)"><div class="pdot" style="background:#FFFC00"></div>Snapchat</button>
      <div class="ns">Data</div>
      <button class="ni" onclick="gp('orders',this)">
        <svg class="ni-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 4H14M4 8H12M6 12H10"/></svg>Orders
      </button>
      <button class="ni" onclick="gp('analytics',this)">
        <svg class="ni-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12L5 8L8 10L11 5L14 8"/><path d="M2 2V14H14"/></svg>Analytics
      </button>
      <button class="ni" onclick="gp('clickmap',this)">
        <svg class="ni-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6.5"/><path d="M8 4v4l3 2"/></svg>Click Map
      </button>
      <button class="ni" onclick="gp('roi',this)">
        <svg class="ni-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 13L6 8l3 3 5-7"/></svg>ROI
      </button>
      <div class="ns">Settings</div>
      <button class="ni" onclick="gp('postback',this)">
        <svg class="ni-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M13 8H3M8 3l-5 5 5 5"/></svg>Postback URLs
      </button>
      <button class="ni" onclick="gp('notifications',this)">
        <svg class="ni-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M8 14c.55 0 1-.45 1-1H7c0 .55.45 1 1 1zm5-3V7c0-2.76-1.86-5.07-4.5-5.69V1c0-.55-.45-1-1-1s-1 .45-1 1v.31C3.86 1.93 2 4.24 2 7v4l-1 1v1h14v-1l-1-1z"/></svg>Notifications
      </button>
      <button class="ni" onclick="gp('help',this)">
        <svg class="ni-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6.5"/><path d="M6 6c0-1.1.9-2 2-2s2 .9 2 2c0 1.1-.89 1.79-1.71 2.14C7.53 8.46 7.5 8.77 7.5 9"/><circle cx="8" cy="11.5" r=".5" fill="currentColor"/></svg>Help & FAQ
      </button>
    </div>
    <div class="sf">
      <div class="uinfo">
        <div class="uav" id="uav">?</div>
        <div style="overflow:hidden"><div class="uname" id="uname">Loading...</div><div class="urole" id="urole">member</div></div>
      </div>
      <div class="fa">
        <button class="lout" onclick="logout()">Sign out</button>
        <div class="ib" onclick="toggleTheme()" id="theme-icon" style="margin-left:auto">üåô</div>
      </div>
    </div>
  </nav>

  <div class="main">
    <div class="topbar">
      <div class="tb-title" id="pgtitle">Dashboard</div>
      <div class="tb-date" id="curdate"></div>
      <div class="ib" onclick="refreshPage()">‚Üª</div>
    </div>
    <div class="content">

      <!-- DASHBOARD -->
      <div class="page active" id="page-dashboard">
        <div class="admin-panel" id="admin-panel" style="display:none">
          <div class="admin-badge">‚ö° ADMIN VIEW</div>
          <div style="font-size:13px;font-weight:600;color:var(--white);margin-bottom:12px;">Team Members</div>
          <div class="user-cards" id="user-cards"></div>
          <div id="user-detail-section" style="display:none">
            <div class="filters" id="ud-filters" style="margin-bottom:10px">
              <button class="fb active" onclick="filterUD('30days',this)">30 Days</button>
              <button class="fb" onclick="filterUD('today',this)">Today</button>
              <button class="fb" onclick="filterUD('7days',this)">7 Days</button>
              <button class="fb" onclick="filterUD('6months',this)">6 Months</button>
              <button class="fb" onclick="filterUD('year',this)">Year</button>
            </div>
            <div class="user-detail" id="user-detail"></div>
          </div>
        </div>
        <div class="sg">
          <div class="sc"><div class="slabel">Revenue Today</div><div class="sval" id="rev-today"><span class="cur">$</span>0.00</div><div class="schange neu" id="rev-change">‚Äì</div></div>
          <div class="sc"><div class="slabel">Orders Today</div><div class="sval" id="ord-today">0</div><div class="schange neu" id="ord-change">‚Äì</div></div>
          <div class="sc"><div class="slabel">Total Revenue</div><div class="sval" id="rev-total"><span class="cur">$</span>0.00</div><div class="schange neu" id="total-lbl">‚Äì</div></div>
          <div class="sc"><div class="slabel">Conversion Rate</div><div class="sval" id="cvr-rate">0%</div><div class="schange neu" id="cvr-lbl">‚Äì</div></div>
        </div>
        <div class="sr">
          <div class="card">
            <div class="ch"><div class="ct">Revenue by Platform</div><div class="cb">Today</div></div>
            <div class="cbody"><div class="pl" id="platform-list"></div></div>
          </div>
          <div class="card">
            <div class="ch"><div class="ct">Conversion Rate</div><div class="cb">Clicks ‚Üí Orders</div></div>
            <div class="cbody">
              <div class="cvb"><div class="cvn" id="cvn">0</div><div class="cvp">%</div></div>
              <div class="cvd" id="cvd">No data yet</div>
              <div class="cvbl"><span>0%</span><span id="cvbr">0%</span></div>
              <div class="cvt"><div class="cvf" id="cvf" style="width:0%"></div></div>
            </div>
          </div>
        </div>
        <div class="tc">
          <div class="ch"><div class="ct">Recent Orders</div><div class="cb" id="recent-badge">0 today</div></div>
          <div class="tw"><table><thead><tr><th>Transaction ID</th><th>Platform</th><th>Campaign</th><th>Payout</th><th>Pixels</th><th>Time</th></tr></thead><tbody id="dash-tbody"></tbody></table></div>
        </div>
      </div>

      <!-- ADMIN -->
      <div class="page" id="page-admin">
        <div style="font-size:15px;font-weight:700;color:var(--white);margin-bottom:4px;">Team & Users</div>
        <div style="font-size:12px;color:var(--muted2);margin-bottom:16px;">Click a user to view their full stats</div>
        <div class="user-cards" id="admin-user-cards"></div>
        <div id="admin-detail-section" style="display:none">
          <div class="filters" id="admin-ud-filters" style="margin-bottom:10px">
            <button class="fb active" onclick="filterAdminUD('30days',this)">30 Days</button>
            <button class="fb" onclick="filterAdminUD('today',this)">Today</button>
            <button class="fb" onclick="filterAdminUD('7days',this)">7 Days</button>
            <button class="fb" onclick="filterAdminUD('6months',this)">6 Months</button>
            <button class="fb" onclick="filterAdminUD('year',this)">Year</button>
          </div>
          <div class="user-detail" id="admin-user-detail"></div>
        </div>
      </div>

      <!-- ORDERS -->
      <div class="page" id="page-orders">
        <div class="filters">
          <button class="fb active" onclick="foFilter('all',this)">All Time</button>
          <button class="fb" onclick="foFilter('today',this)">Today</button>
          <button class="fb" onclick="foFilter('yesterday',this)">Yesterday</button>
          <button class="fb" onclick="foFilter('7days',this)">7 Days</button>
          <button class="fb" onclick="foFilter('30days',this)">30 Days</button>
          <button class="fb" onclick="foFilter('6months',this)">6 Months</button>
          <button class="fb" onclick="foFilter('year',this)">Year</button>
        </div>
        <div class="sbar">
          <input class="si" type="text" id="osearch" placeholder="Search by transaction ID..." oninput="searchOrders()">
          <button class="eb" onclick="exportCSV()">‚¨á CSV</button>
        </div>
        <div class="tc">
          <div class="ch"><div class="ct">Orders</div><div class="cb" id="ord-badge">‚Äì</div></div>
          <div class="tw"><table><thead><tr><th>Transaction ID</th><th>Platform</th><th>Type</th><th>Offer</th><th>Campaign</th><th>Country</th><th>Device</th><th>Payout</th><th>Network</th><th>Pixels</th><th>Time</th></tr></thead><tbody id="ord-tbody"></tbody></table></div>
        </div>
      </div>

      <!-- ANALYTICS -->
      <div class="page" id="page-analytics">
        <div class="filters">
          <button class="fb active" onclick="faFilter('30days',this)">30 Days</button>
          <button class="fb" onclick="faFilter('today',this)">Today</button>
          <button class="fb" onclick="faFilter('yesterday',this)">Yesterday</button>
          <button class="fb" onclick="faFilter('7days',this)">7 Days</button>
          <button class="fb" onclick="faFilter('6months',this)">6 Months</button>
          <button class="fb" onclick="faFilter('year',this)">Year</button>
        </div>
        <div class="ag" id="analytics-grid"></div>
      </div>

      <!-- CLICK MAP -->
      <div class="page" id="page-clickmap">
        <div class="filters">
          <button class="fb active" onclick="fcFilter('7days',this)">7 Days</button>
          <button class="fb" onclick="fcFilter('today',this)">Today</button>
          <button class="fb" onclick="fcFilter('30days',this)">30 Days</button>
          <button class="fb" onclick="fcFilter('6months',this)">6 Months</button>
          <button class="fb" onclick="fcFilter('year',this)">Year</button>
        </div>
        <div class="tc">
          <div class="ch"><div class="ct">Clicks vs Conversions</div><div class="cb">Campaign ‚Üí Ad level</div></div>
          <div class="cbody">
            <div style="display:grid;grid-template-columns:1fr 70px 70px 70px 80px;gap:9px;padding-bottom:7px;border-bottom:1px solid var(--border);margin-bottom:3px;">
              <div style="font-size:9px;font-family:'Geist Mono',monospace;color:var(--muted2);text-transform:uppercase;letter-spacing:1px">Campaign / Ad</div>
              <div style="font-size:9px;font-family:'Geist Mono',monospace;color:var(--muted2);text-align:right">CLICKS</div>
              <div style="font-size:9px;font-family:'Geist Mono',monospace;color:var(--muted2);text-align:right">SALES</div>
              <div style="font-size:9px;font-family:'Geist Mono',monospace;color:var(--muted2);text-align:right">CVR</div>
              <div style="font-size:9px;font-family:'Geist Mono',monospace;color:var(--muted2);text-align:right">REVENUE</div>
            </div>
            <div id="clickmap-list"></div>
          </div>
        </div>
      </div>

      <!-- ROI -->
      <div class="page" id="page-roi">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:13px;flex-wrap:wrap;">
          <div class="filters" style="margin-bottom:0;flex:1;flex-wrap:wrap">
            <button class="fb active" onclick="frFilter('30days',this)">30 Days</button>
            <button class="fb" onclick="frFilter('today',this)">Today</button>
            <button class="fb" onclick="frFilter('7days',this)">7 Days</button>
            <button class="fb" onclick="frFilter('6months',this)">6 Months</button>
            <button class="fb" onclick="frFilter('year',this)">Year</button>
          </div>
          <button class="eb" onclick="document.getElementById('spend-modal').classList.add('v')">+ Add Spend</button>
        </div>
        <div class="rg" id="roi-grid"></div>
      </div>

      <!-- POSTBACK -->
      <div class="page" id="page-postback">
        <div class="pbh">
          <div style="font-size:15px;font-weight:700;color:var(--white);margin-bottom:5px">Your Postback URL</div>
          <div style="font-size:12px;color:var(--muted2);margin-bottom:18px;line-height:1.8">Copy this URL and paste it into your CPA network's postback settings. Every confirmed sale triggers this URL and gets logged.</div>
          <div class="pburl" id="pb-url">Loading...</div>
          <button class="cpbtn" onclick="copyPB()">üìã Copy URL</button>
          <span class="cpsuc" id="cpsuc">‚úì Copied!</span>
        </div>
        <div class="card">
          <div class="ch"><div class="ct">Available Macros</div><div class="cb">Replace with network placeholders</div></div>
          <div class="cbody">
            <table class="mt">
              <tr><td>{CLICK_ID}</td><td>Your click tracking ID ‚Äî must be passed from landing page through to offer</td></tr>
              <tr><td>{PAYOUT}</td><td>Confirmed sale payout amount (e.g. 45.00)</td></tr>
              <tr><td>{TRANSACTION_ID}</td><td>Network's unique transaction or order ID</td></tr>
              <tr><td>{OFFER_ID}</td><td>Offer ID from the network</td></tr>
              <tr><td>{OFFER_NAME}</td><td>Offer name ‚Äî used for analytics grouping and pixel assignment</td></tr>
              <tr><td>{COUNTRY}</td><td>Buyer's country code (e.g. US, MA, FR)</td></tr>
              <tr><td>{DEVICE}</td><td>Device type (mobile / desktop)</td></tr>
            </table>
            <div style="margin-top:14px;padding:11px;background:var(--s2);border-radius:8px;font-size:11px;color:var(--muted2);line-height:1.9">
              <strong style="color:var(--text)">Adexico:</strong> use <code>{clickid}</code> ¬∑ <code>{payout}</code> ¬∑ <code>{transaction_id}</code><br>
              <strong style="color:var(--text)">Click tracking format:</strong> <code>?click_id=ID&source=meta&campaign=NAME&campaign_type=search&ad=AD_ID&user_id=YOUR_UID</code>
            </div>
          </div>
        </div>
      </div>

      <!-- NOTIFICATIONS -->
      <div class="page" id="page-notifications">
        <div class="nc">
          <div style="font-size:14px;font-weight:700;color:var(--white);margin-bottom:4px">üîî Push Notifications</div>
          <div style="font-size:12px;color:var(--muted2);margin-bottom:18px;line-height:1.8">Get an iPhone push notification with a cash register sound every time a sale comes in. Free via Pushover.</div>
          <div class="fr">
            <div class="fg"><label class="fl">Pushover User Key</label><input class="fi" type="text" id="nuk" placeholder="Your Pushover user key"></div>
            <div class="fg"><label class="fl">Pushover API Token</label><input class="fi" type="text" id="nat" placeholder="Your app API token"></div>
          </div>
          <button class="bsave" onclick="saveNotif()">Save Settings</button>
          <button class="bsec" onclick="testNotif()">Send Test</button>
          <div class="smsg" id="nsmsg">‚úì Saved ‚Äî notifications active</div>
          <div class="errmsg" id="nerrmsg"></div>
        </div>
        <div class="card">
          <div class="ch"><div class="ct">How to set up Pushover</div></div>
          <div class="cbody" style="font-size:12px;color:var(--muted2);line-height:2.2">
            1. Go to <strong style="color:var(--text)">pushover.net</strong> ‚Üí create free account<br>
            2. Copy your <strong style="color:var(--text)">User Key</strong><br>
            3. Click "Create Application" ‚Üí name it anything ‚Üí copy <strong style="color:var(--text)">API Token</strong><br>
            4. Download <strong style="color:var(--text)">Pushover</strong> on iPhone ‚Üí log in<br>
            5. Paste both keys above ‚Üí Save ‚Üí Send Test
          </div>
        </div>
      </div>

      <!-- PIXEL PAGES -->
      <div class="page" id="page-pixels-meta"><div id="pf-meta"></div></div>
      <div class="page" id="page-pixels-tiktok"><div id="pf-tiktok"></div></div>
      <div class="page" id="page-pixels-google"><div id="pf-google"></div></div>
      <div class="page" id="page-pixels-snapchat"><div id="pf-snapchat"></div></div>

      <!-- HELP -->
      <div class="page" id="page-help">
        <div style="font-size:15px;font-weight:700;color:var(--white);margin-bottom:4px">Help & FAQ</div>
        <div style="font-size:12px;color:var(--muted2);margin-bottom:16px">Everything you need to know to use the platform</div>
        <div id="faq-container"></div>
      </div>

    </div>
  </div>
</div>

<div class="mo" id="spend-modal">
  <div class="modal">
    <div class="modal-title">Add Ad Spend</div>
    <div class="modal-sub">Enter spend to calculate ROI and profit per offer</div>
    <div class="fg"><label class="fl">Platform</label><select class="fi" id="sm-plat"><option value="meta">Meta</option><option value="google">Google</option><option value="tiktok">TikTok</option><option value="snapchat">Snapchat</option></select></div>
    <div class="fg"><label class="fl">Campaign ID</label><input class="fi" type="text" id="sm-camp" placeholder="e.g. Summer_v3"></div>
    <div class="fg"><label class="fl">Offer Name</label><input class="fi" type="text" id="sm-offer" placeholder="e.g. Product X"></div>
    <div class="fg"><label class="fl">Amount Spent ($)</label><input class="fi" type="number" id="sm-amt" placeholder="250.00"></div>
    <div class="fg"><label class="fl">Date</label><input class="fi" type="date" id="sm-date"></div>
    <div class="mf"><button class="bsave" onclick="saveSpend()">Save</button><button class="bcancel" onclick="document.getElementById('spend-modal').classList.remove('v')">Cancel</button></div>
  </div>
</div>

<script>
let token=localStorage.getItem('tracker_token');
let CU=null,curPage='dashboard',oPeriod='all',aPeriod='30days',cPeriod='7days',rPeriod='30days',udPeriod='30days',adminUDPeriod='30days';
let allOrders=[],pixelData={},teamData=[],selUser=null,adminSelUser=null;
let isDark=localStorage.getItem('theme')!=='light';

const PC={
  meta:{c:'#0082fb',l:'Meta',tag:'tag-meta'},facebook:{c:'#0082fb',l:'Meta',tag:'tag-meta'},
  tiktok:{c:'#ff2d55',l:'TikTok',tag:'tag-tt'},
  google:{c:'#4285f4',l:'Google',tag:'tag-google'},youtube:{c:'#4285f4',l:'Google',tag:'tag-google'},
  snapchat:{c:'#b8b000',l:'Snapchat',tag:'tag-snap'},snap:{c:'#b8b000',l:'Snapchat',tag:'tag-snap'},
  unknown:{c:'#888',l:'Unknown',tag:''}
};

const PCFG={
  meta:{icon:'üìò',color:'#0082fb',label:'Meta',fields:[{key:'pixel_id',label:'Pixel ID',ph:'e.g. 1234567890'},{key:'access_token',label:'CAPI Access Token',ph:'e.g. EAAxxxxxx'}],help:'Facebook Events Manager ‚Üí Your Dataset ‚Üí Settings ‚Üí Dataset ID. For CAPI token: Events Manager ‚Üí Settings ‚Üí Conversions API ‚Üí Generate Access Token.'},
  tiktok:{icon:'üéµ',color:'#ff2d55',label:'TikTok',fields:[{key:'pixel_id',label:'Pixel ID',ph:'e.g. CXXXXXXXXX'},{key:'access_token',label:'Events API Access Token',ph:'e.g. xxxxxx'}],help:'TikTok Ads Manager ‚Üí Assets ‚Üí Events ‚Üí Web Events ‚Üí your pixel ‚Üí Events API tab ‚Üí Generate Access Token.'},
  google:{icon:'üîç',color:'#4285f4',label:'Google',fields:[{key:'pixel_id',label:'Customer ID',ph:'e.g. 123-456-7890'},{key:'access_token',label:'OAuth2 Access Token',ph:'e.g. ya29.xxxxxx'}],help:'Google Ads ‚Üí Tools ‚Üí Conversions. Supports Search, Display, YouTube, Shopping, and Performance Max (PMax) campaigns. Pass campaign_type parameter in your click URL: search | display | youtube | shopping | pmax.'},
  snapchat:{icon:'üëª',color:'#FFFC00',label:'Snapchat',fields:[{key:'pixel_id',label:'Pixel ID (CAPI)',ph:'e.g. xxxxxxxx-xxxx-xxxx-xxxx'},{key:'access_token',label:'Access Token (CAPI)',ph:'e.g. eyJhbGc...'},{key:'snap_pixel_id',label:'Snap Pixel ID (browser)',ph:'e.g. xxxxxxxx'}],help:'Snapchat Ads Manager ‚Üí Assets ‚Üí Pixels ‚Üí your pixel ‚Üí Setup ‚Üí API & Access Token. Browser pixel fires on page load; CAPI fires server-side on confirmed sale.'}
};

function gpk(s){const v=(s||'').toLowerCase();if(v.includes('meta')||v.includes('facebook')||v.includes('fb'))return'meta';if(v.includes('tiktok')||v.includes('tt'))return'tiktok';if(v.includes('google')||v.includes('youtube')||v.includes('yt'))return'google';if(v.includes('snap'))return'snapchat';return'unknown';}
function fmt(n){return parseFloat(n||0).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});}
function ago(d){const diff=(Date.now()-new Date(d))/1000;if(diff<60)return'just now';if(diff<3600)return`${Math.floor(diff/60)}m ago`;if(diff<86400)return`${Math.floor(diff/3600)}h ago`;return new Date(d).toLocaleDateString('en-US',{month:'short',day:'numeric'});}
async function api(url,opts={}){const r=await fetch(url,{...opts,headers:{'Content-Type':'application/json','Authorization':`Bearer ${token}`,...(opts.headers||{})}});return r.json();}

function toggleTheme(){isDark=!isDark;applyTheme();localStorage.setItem('theme',isDark?'dark':'light');}
function applyTheme(){document.body.setAttribute('data-theme',isDark?'':'light');const ic=isDark?'üåô':'‚òÄÔ∏è';['theme-icon','mtheme'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=ic;});}
function toggleSB(){document.getElementById('sidebar').classList.toggle('open');document.getElementById('ov').classList.toggle('v');}
function showSU(){document.getElementById('lf').style.display='none';document.getElementById('suf').style.display='block';}
function showLI(){document.getElementById('suf').style.display='none';document.getElementById('lf').style.display='block';}

async function login(){
  const email=document.getElementById('le').value,password=document.getElementById('lp').value;
  const err=document.getElementById('lerr');err.classList.remove('v');
  if(!email||!password){err.textContent='Please fill in all fields';err.classList.add('v');return;}
  const btn=event.target;btn.disabled=true;btn.textContent='Signing in...';
  const d=await api('/api/auth/login',{method:'POST',body:JSON.stringify({email,password})});
  btn.disabled=false;btn.textContent='Sign in';
  if(d.error){err.textContent=d.error;err.classList.add('v');return;}
  token=d.token;localStorage.setItem('tracker_token',token);CU=d.user;showApp();
}

async function signup(){
  const name=document.getElementById('sn').value,email=document.getElementById('se').value,password=document.getElementById('sp').value;
  const err=document.getElementById('serr');err.classList.remove('v');
  if(!name||!email||!password){err.textContent='Please fill in all fields';err.classList.add('v');return;}
  if(password.length<6){err.textContent='Min 6 characters';err.classList.add('v');return;}
  const btn=event.target;btn.disabled=true;btn.textContent='Creating...';
  const d=await api('/api/auth/signup',{method:'POST',body:JSON.stringify({name,email,password})});
  btn.disabled=false;btn.textContent='Create account';
  if(d.error){err.textContent=d.error;err.classList.add('v');return;}
  token=d.token;localStorage.setItem('tracker_token',token);CU=d.user;showApp();
}

function logout(){localStorage.removeItem('tracker_token');token=null;CU=null;document.getElementById('app').classList.remove('active');document.getElementById('login-page').classList.add('active');}

function showApp(){
  document.getElementById('login-page').classList.remove('active');
  document.getElementById('app').classList.add('active');
  document.getElementById('uname').textContent=CU.name||CU.email;
  document.getElementById('urole').textContent=CU.role;
  document.getElementById('uav').textContent=(CU.name||CU.email)[0].toUpperCase();
  document.getElementById('curdate').textContent=new Date().toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'});
  applyTheme();
  if(CU.role==='admin'){
    document.getElementById('nav-admin').style.display='flex';
    document.getElementById('admin-panel').style.display='block';
    document.getElementById('page-admin').style.display='none';
    loadTeam();
  }
  renderPB();loadDash();loadPixels();loadNotifSettings();renderFAQ();
  document.getElementById('sm-date').value=new Date().toISOString().split('T')[0];
}

const pgTitles={dashboard:'Dashboard',admin:'Team & Users',orders:'Orders',analytics:'Analytics',clickmap:'Click Map',roi:'ROI',postback:'Postback URLs',notifications:'Notifications',help:'Help & FAQ','pixels-meta':'Meta ‚Äî Pixels','pixels-tiktok':'TikTok ‚Äî Pixels','pixels-google':'Google ‚Äî Pixels','pixels-snapchat':'Snapchat ‚Äî Pixels'};

function gp(page,btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.ni').forEach(n=>n.classList.remove('active'));
  const el=document.getElementById('page-'+page);
  if(el){el.style.display='';el.classList.add('active');}
  if(btn)btn.classList.add('active');
  curPage=page;
  const t=pgTitles[page]||page;
  document.getElementById('pgtitle').textContent=t;
  document.getElementById('mtitle').textContent=t;
  if(page==='orders')loadOrders(oPeriod);
  if(page==='analytics')loadAnalytics(aPeriod);
  if(page==='clickmap')loadClickmap(cPeriod);
  if(page==='roi')loadROI(rPeriod);
  if(page.startsWith('pixels-'))renderPixelForm(page.replace('pixels-',''));
  if(page==='admin')renderAdminPage();
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('ov').classList.remove('v');
}

function refreshPage(){
  if(curPage==='dashboard')loadDash();
  else if(curPage==='orders')loadOrders(oPeriod);
  else if(curPage==='analytics')loadAnalytics(aPeriod);
  else if(curPage==='clickmap')loadClickmap(cPeriod);
  else if(curPage==='roi')loadROI(rPeriod);
}

function renderPB(){
  const base=window.location.origin,uid=CU?.id||'YOUR_USER_ID';
  document.getElementById('pb-url').textContent=`${base}/postback?click_id={CLICK_ID}&payout={PAYOUT}&transaction_id={TRANSACTION_ID}&offer_id={OFFER_ID}&network=adexico&offer_name={OFFER_NAME}&country={COUNTRY}&device={DEVICE}&user_id=${uid}`;
}

function copyPB(){
  navigator.clipboard.writeText(document.getElementById('pb-url').textContent);
  const el=document.getElementById('cpsuc');el.classList.add('v');setTimeout(()=>el.classList.remove('v'),2500);
}

async function loadDash(){
  const s=await api('/api/stats');if(s.error)return;
  document.getElementById('rev-today').innerHTML=`<span class="cur">$</span>${fmt(s.revenue_today)}`;
  document.getElementById('ord-today').textContent=s.orders_today||0;
  document.getElementById('rev-total').innerHTML=`<span class="cur">$</span>${fmt(s.revenue_total)}`;
  document.getElementById('cvr-rate').textContent=`${(s.conversion_rate||0).toFixed(1)}%`;
  document.getElementById('cvn').textContent=(s.conversion_rate||0).toFixed(1);
  document.getElementById('cvf').style.width=`${Math.min((s.conversion_rate||0)*5,100)}%`;
  document.getElementById('cvbr').textContent=`${(s.conversion_rate||0).toFixed(1)}%`;
  document.getElementById('cvd').textContent=`${s.total_clicks||0} clicks ‚Üí ${s.total_orders||0} orders`;
  document.getElementById('cvr-lbl').textContent=`${s.total_clicks||0} tracked clicks`;
  document.getElementById('total-lbl').textContent=`${s.total_orders||0} total orders`;
  document.getElementById('recent-badge').textContent=`${s.orders_today||0} today`;
  const rc=s.revenue_change||0,oc=s.orders_change||0;
  document.getElementById('rev-change').innerHTML=`<span class="${rc>=0?'up':'down'}">${rc>=0?'‚Üë':'‚Üì'} ${Math.abs(rc).toFixed(1)}% vs yesterday</span>`;
  document.getElementById('ord-change').innerHTML=`<span class="${oc>=0?'up':'down'}">${oc>=0?'+':''}${oc} vs yesterday</span>`;
  renderPlatforms(s.by_platform||[]);
  const orders=await api('/api/orders?limit=8');renderRows(orders,'dash-tbody',true);
}

function renderPlatforms(pts){
  const total=pts.reduce((s,p)=>s+parseFloat(p.revenue||0),0);
  const keys=['meta','google','tiktok','snapchat'];
  const map={};pts.forEach(p=>{map[gpk(p.source)]=p;});
  document.getElementById('platform-list').innerHTML=keys.map(k=>{
    const p=map[k];const rev=p?parseFloat(p.revenue||0):0;const pct=total>0?(rev/total*100):0;const cfg=PC[k];
    return `<div class="pr"><div class="pi"><div class="pdot" style="background:${cfg.c}"></div><div class="pname">${cfg.l}</div></div><div class="bt"><div class="bf" style="width:${pct}%;background:${cfg.c};opacity:.8"></div></div><div class="pamt">$${fmt(rev)}</div></div>`;
  }).join('');
}

function foFilter(p,btn){oPeriod=p;document.querySelectorAll('#page-orders .fb').forEach(b=>b.classList.remove('active'));btn.classList.add('active');loadOrders(p);}
async function loadOrders(period){
  const url=period==='all'?'/api/orders?limit=300':`/api/orders?limit=300&period=${period}`;
  allOrders=await api(url);
  document.getElementById('ord-badge').textContent=`${Array.isArray(allOrders)?allOrders.length:0} orders`;
  renderRows(allOrders,'ord-tbody',false);
}
function searchOrders(){const q=document.getElementById('osearch').value.toLowerCase();if(!q){renderRows(allOrders,'ord-tbody',false);return;}renderRows(allOrders.filter(o=>(o.transaction_id||'').toLowerCase().includes(q)),'ord-tbody',false);}
function exportCSV(){
  if(!allOrders.length){alert('No orders to export');return;}
  const h=['Transaction ID','Platform','Type','Offer','Campaign','Country','Device','Payout','Network','Time'];
  const rows=allOrders.map(o=>[o.transaction_id,gpk(o.traffic_source),o.campaign_type||'',o.offer_name||'',o.campaign_id||'',o.country||'',o.device_type||'',o.payout,o.network,o.received_at].map(v=>`"${v||''}"`).join(','));
  const csv=[h.join(','),...rows].join('\n');const a=document.createElement('a');a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);a.download=`orders_${new Date().toISOString().split('T')[0]}.csv`;a.click();
}

function renderRows(orders,id,compact){
  const tbody=document.getElementById(id);const cols=compact?6:11;
  if(!orders||!orders.length){tbody.innerHTML=`<tr><td colspan="${cols}"><div class="empty"><div class="eicon">üì≠</div><div class="etitle">No orders yet</div></div></td></tr>`;return;}
  tbody.innerHTML=orders.map(o=>{
    const pk=gpk(o.traffic_source);const cfg=PC[pk];
    const pixels=`<div class="pxc"><div class="pxd ${o.pixel_fired_fb?'px-on':'px-off'}">FB</div><div class="pxd ${o.pixel_fired_tt?'px-on':'px-off'}">TT</div><div class="pxd ${o.pixel_fired_snap?'px-on':'px-off'}">SC</div><div class="pxd ${o.pixel_fired_google?'px-on':'px-off'}">GG</div></div>`;
    if(compact)return `<tr><td class="ic">${(o.transaction_id||'‚Äì').substring(0,13)}...</td><td><span class="ptag ${cfg.tag}"><span class="tdot"></span>${cfg.l}</span></td><td style="color:var(--muted2)">${o.campaign_id||'‚Äì'}</td><td class="pc">+$${fmt(o.payout)}</td><td>${pixels}</td><td class="tc2">${ago(o.received_at)}</td></tr>`;
    return `<tr><td class="ic">${(o.transaction_id||'‚Äì').substring(0,13)}...</td><td><span class="ptag ${cfg.tag}"><span class="tdot"></span>${cfg.l}</span></td><td style="color:var(--muted2);font-size:10px">${o.campaign_type||'‚Äì'}</td><td style="color:var(--muted2);font-size:10px">${o.offer_name||'‚Äì'}</td><td style="color:var(--muted2);font-size:10px">${o.campaign_id||'‚Äì'}</td><td style="color:var(--muted2);font-size:10px">${o.country||'‚Äì'}</td><td style="color:var(--muted2);font-size:10px">${o.device_type||'‚Äì'}</td><td class="pc">+$${fmt(o.payout)}</td><td style="color:var(--muted2);font-size:10px">${o.network||'‚Äì'}</td><td>${pixels}</td><td class="tc2">${ago(o.received_at)}</td></tr>`;
  }).join('');
}

function faFilter(p,btn){aPeriod=p;document.querySelectorAll('#page-analytics .fb').forEach(b=>b.classList.remove('active'));btn.classList.add('active');loadAnalytics(p);}
async function loadAnalytics(period){
  const data=await api(`/api/analytics?period=${period}`);const grid=document.getElementById('analytics-grid');
  if(!data||!data.length){grid.innerHTML=`<div class="empty"><div class="eicon">üìä</div><div class="etitle">No data</div></div>`;return;}
  grid.innerHTML=data.map(r=>{
    const pk=gpk(r.platform);const cfg=PC[pk];
    return `<div class="acard"><div class="apl" style="background:${cfg.c}20;color:${cfg.c};border:1px solid ${cfg.c}30"><span class="tdot" style="background:${cfg.c}"></span>${cfg.l}${r.campaign_type?` ¬∑ ${r.campaign_type}`:''}</div><div class="ao">${r.offer_name||'Unknown'}</div><div class="au">${r.landing_page_url||r.campaign_id||'‚Äì'}</div><div class="as2"><div class="ast"><div class="asv" style="color:var(--green)">$${fmt(r.revenue)}</div><div class="asl">Revenue</div></div><div class="ast"><div class="asv">${r.sales}</div><div class="asl">Sales</div></div><div class="ast"><div class="asv">$${fmt(r.avg_payout)}</div><div class="asl">Avg</div></div></div><div class="am">${r.ad_creative?`<span class="achip">üé® ${r.ad_creative}</span>`:''} ${r.country?`<span class="achip">üåç ${r.country}</span>`:''} ${r.device_type?`<span class="achip">üì± ${r.device_type}</span>`:''}</div></div>`;
  }).join('');
}

function fcFilter(p,btn){cPeriod=p;document.querySelectorAll('#page-clickmap .fb').forEach(b=>b.classList.remove('active'));btn.classList.add('active');loadClickmap(p);}
async function loadClickmap(period){
  const data=await api(`/api/clickmap?period=${period}`);const list=document.getElementById('clickmap-list');
  if(!data||!data.length){list.innerHTML=`<div class="empty"><div class="eicon">üó∫</div><div class="etitle">No click data yet</div></div>`;return;}
  list.innerHTML=data.map(r=>{
    const pk=gpk(r.traffic_source);const cfg=PC[pk];const cvr=parseFloat(r.cvr||0);
    return `<div class="cmr"><div><div class="cmc">${r.campaign_id||'Unknown'} <span class="ptag ${cfg.tag}" style="font-size:9px">${cfg.l}</span></div><div class="cma">${r.ad_id||'‚Äì'}${r.campaign_type?' ¬∑ '+r.campaign_type:''}</div></div><div class="cmn" style="color:var(--text)">${r.clicks}</div><div class="cmn" style="color:var(--green)">${r.conversions}</div><div class="cmn" style="color:${cvr>3?'var(--green)':cvr>1?'var(--orange)':'var(--red)'}">${cvr}%</div><div class="cmn" style="color:var(--green)">$${fmt(r.revenue)}</div></div>`;
  }).join('');
}

function frFilter(p,btn){rPeriod=p;document.querySelectorAll('#page-roi .fb').forEach(b=>b.classList.remove('active'));btn.classList.add('active');loadROI(p);}
async function loadROI(period){
  const data=await api(`/api/roi?period=${period}`);const grid=document.getElementById('roi-grid');
  if(!data||!data.length){grid.innerHTML=`<div class="empty"><div class="eicon">üí∞</div><div class="etitle">No ROI data</div><div class="esub">Add ad spend to calculate profit</div></div>`;return;}
  grid.innerHTML=data.map(r=>{
    const pk=gpk(r.platform);const cfg=PC[pk];const profit=parseFloat(r.profit||0);
    const cls=profit>0?'pos':profit<0?'neg':'neu2';
    const roi=parseFloat(r.spend||0)>0?((profit/parseFloat(r.spend))*100).toFixed(0):null;
    return `<div class="rc"><div class="ro">${r.offer_name||'Unknown'}</div><div class="rp" style="background:${cfg.c}20;color:${cfg.c};border:1px solid ${cfg.c}30"><span class="tdot" style="background:${cfg.c}"></span>${cfg.l}</div><div class="rs"><div class="rst"><div class="rsv" style="color:var(--green)">$${fmt(r.revenue)}</div><div class="rsl">Revenue</div></div><div class="rst"><div class="rsv" style="color:var(--red)">$${fmt(r.spend)}</div><div class="rsl">Spend</div></div><div class="rst"><div class="rsv">${r.sales}</div><div class="rsl">Sales</div></div><div class="rst"><div class="rsv">$${fmt(r.aov)}</div><div class="rsl">AOV</div></div></div><div class="rprofit ${cls}">${profit>=0?'+':''}$${fmt(profit)} profit${roi?` ¬∑ ${roi}% ROI`:''}</div></div>`;
  }).join('');
}

async function saveSpend(){
  const spend=document.getElementById('sm-amt').value;if(!spend){alert('Enter spend amount');return;}
  await api('/api/spend',{method:'POST',body:JSON.stringify({platform:document.getElementById('sm-plat').value,campaign_id:document.getElementById('sm-camp').value,offer_name:document.getElementById('sm-offer').value,spend,spend_date:document.getElementById('sm-date').value})});
  document.getElementById('spend-modal').classList.remove('v');loadROI(rPeriod);
}

async function loadTeam(){
  teamData=await api('/api/team');if(!Array.isArray(teamData))return;
  const html=teamData.map(u=>`<div class="user-card" onclick="selectUser('${u.id}',this,'dash')"><div class="uc-av">${(u.name||u.email)[0].toUpperCase()}</div><div class="uc-name">${u.name||'‚Äì'}</div><div class="uc-email">${u.email}</div><span class="uc-role role-${u.role}">${u.role}</span></div>`).join('');
  document.getElementById('user-cards').innerHTML=html;
  document.getElementById('admin-user-cards').innerHTML=teamData.map(u=>`<div class="user-card" onclick="selectUser('${u.id}',this,'admin')"><div class="uc-av">${(u.name||u.email)[0].toUpperCase()}</div><div class="uc-name">${u.name||'‚Äì'}</div><div class="uc-email">${u.email}</div><span class="uc-role role-${u.role}">${u.role}</span></div>`).join('');
}

function renderAdminPage(){if(teamData.length)return;}

async function selectUser(uid,card,ctx){
  const isAdmin=ctx==='admin';
  const cards=isAdmin?document.querySelectorAll('#admin-user-cards .user-card'):document.querySelectorAll('#user-cards .user-card');
  cards.forEach(c=>c.classList.remove('selected'));card.classList.add('selected');
  if(isAdmin){adminSelUser=uid;document.getElementById('admin-detail-section').style.display='block';loadUserDetail(uid,adminUDPeriod,'admin-user-detail');}
  else{selUser=uid;document.getElementById('user-detail-section').style.display='block';loadUserDetail(uid,udPeriod,'user-detail');}
}

function filterUD(period,btn){udPeriod=period;document.querySelectorAll('#ud-filters .fb').forEach(b=>b.classList.remove('active'));btn.classList.add('active');if(selUser)loadUserDetail(selUser,period,'user-detail');}
function filterAdminUD(period,btn){adminUDPeriod=period;document.querySelectorAll('#admin-ud-filters .fb').forEach(b=>b.classList.remove('active'));btn.classList.add('active');if(adminSelUser)loadUserDetail(adminSelUser,period,'admin-user-detail');}

async function loadUserDetail(uid,period,targetId){
  const u=teamData.find(x=>x.id===uid);
  const data=await api(`/api/team/${uid}/stats?period=${period}`);
  if(data.error)return;const s=data.summary;
  document.getElementById(targetId).innerHTML=`
    <div class="ud-header"><div><div class="ud-name">${u?.name||'User'}</div><div class="ud-email">${u?.email||''}</div></div><span class="uc-role role-${u?.role}">${u?.role}</span></div>
    <div class="ud-stats">
      <div class="ud-stat"><div class="ud-stat-val" style="color:var(--green)">$${fmt(s.revenue)}</div><div class="ud-stat-label">Revenue</div></div>
      <div class="ud-stat"><div class="ud-stat-val">${s.orders}</div><div class="ud-stat-label">Orders</div></div>
      <div class="ud-stat"><div class="ud-stat-val">$${fmt(s.aov)}</div><div class="ud-stat-label">AOV</div></div>
      <div class="ud-stat"><div class="ud-stat-val">${s.cvr}%</div><div class="ud-stat-label">CVR</div></div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
      <div>
        <div style="font-size:11px;font-weight:600;color:var(--white);margin-bottom:8px">By Platform</div>
        ${(data.by_platform||[]).map(p=>{const pk=gpk(p.platform);const cfg=PC[pk];const pct=parseFloat(s.revenue)>0?(parseFloat(p.revenue)/parseFloat(s.revenue)*100):0;return`<div class="pr" style="margin-bottom:8px"><div class="pi"><div class="pdot" style="background:${cfg.c}"></div><div class="pname">${cfg.l}</div></div><div class="bt"><div class="bf" style="width:${pct}%;background:${cfg.c};opacity:.8"></div></div><div class="pamt">$${fmt(p.revenue)}</div></div>`;}).join('')||'<div style="font-size:11px;color:var(--muted2)">No platform data</div>'}
      </div>
      <div>
        <div style="font-size:11px;font-weight:600;color:var(--white);margin-bottom:8px">Top Offers</div>
        ${(data.by_offer||[]).slice(0,6).map(o=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid var(--border)"><div style="font-size:11px;color:var(--text)">${o.offer||'Unknown'}</div><div style="font-size:11px;font-weight:600;color:var(--green);font-family:'Geist Mono',monospace">$${fmt(o.revenue)}</div></div>`).join('')||'<div style="font-size:11px;color:var(--muted2)">No offers yet</div>'}
      </div>
    </div>`;
}

async function loadPixels(){const data=await api('/api/pixels');if(Array.isArray(data)){pixelData={};data.forEach(p=>{if(!pixelData[p.platform])pixelData[p.platform]=[];pixelData[p.platform].push(p);});}}

function renderPixelForm(platform){
  const cfg=PCFG[platform];if(!cfg)return;
  const pixels=pixelData[platform]||[];
  document.getElementById(`pf-${platform}`).innerHTML=`
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
      <div style="width:40px;height:40px;border-radius:10px;background:${cfg.color}20;border:1px solid ${cfg.color}30;display:flex;align-items:center;justify-content:center;font-size:20px">${cfg.icon}</div>
      <div><div style="font-size:15px;font-weight:700;color:var(--white)">${cfg.label}</div><div style="font-size:11px;color:var(--muted2)">${pixels.length} pixel${pixels.length!==1?'s':''} configured</div></div>
    </div>
    <div class="px-list">
      ${pixels.map(p=>`<div class="px-item"><div style="flex:1"><div class="px-name">${p.pixel_name||'Default'}</div><div class="px-id">${p.pixel_id||'‚Äì'}</div></div><button class="px-del" onclick="deletePixel('${p.id}','${platform}')">Remove</button></div>`).join('')}
      ${!pixels.length?`<div style="font-size:11px;color:var(--muted2);padding:8px 0">No pixels added yet. Add your first one below.</div>`:''}
    </div>
    <div class="px-add">
      <div class="px-add-title">Add New Pixel</div>
      <div class="fg"><label class="fl">Pixel Name / Label</label><input class="fi" type="text" id="px-name-${platform}" placeholder="e.g. Main Pixel, Account 2, Brand B"></div>
      ${cfg.fields.map(f=>`<div class="fg"><label class="fl">${f.label}</label><input class="fi" type="text" id="px-${f.key}-${platform}" placeholder="${f.ph}"></div>`).join('')}
      <button class="bsave" onclick="addPixel('${platform}')">Add Pixel</button>
      <div class="smsg" id="px-success-${platform}">‚úì Pixel saved and active</div>
    </div>
    <div class="card" style="margin-top:12px">
      <div class="ch"><div class="ct">Where to find your credentials</div></div>
      <div class="cbody" style="font-size:12px;color:var(--muted2);line-height:2">${cfg.help}</div>
    </div>`;
}

async function addPixel(platform){
  const cfg=PCFG[platform];
  const pixel_name=document.getElementById(`px-name-${platform}`).value||'Default';
  const fields={};cfg.fields.forEach(f=>{fields[f.key]=document.getElementById(`px-${f.key}-${platform}`).value;});
  const data=await api('/api/pixels',{method:'POST',body:JSON.stringify({platform,pixel_name,...fields,enabled:true})});
  if(data.id||data.pixel_id){await loadPixels();renderPixelForm(platform);const m=document.getElementById(`px-success-${platform}`);if(m){m.classList.add('v');setTimeout(()=>m.classList.remove('v'),3000);}}
}

async function deletePixel(id,platform){
  if(!confirm('Remove this pixel?'))return;
  await api(`/api/pixels/${id}`,{method:'DELETE'});
  await loadPixels();renderPixelForm(platform);
}

async function loadNotifSettings(){const data=await api('/api/notifications');if(data.pushover_user_key)document.getElementById('nuk').value=data.pushover_user_key;if(data.pushover_api_token)document.getElementById('nat').value=data.pushover_api_token;}
async function saveNotif(){await api('/api/notifications',{method:'POST',body:JSON.stringify({pushover_user_key:document.getElementById('nuk').value,pushover_api_token:document.getElementById('nat').value,enabled:true})});const m=document.getElementById('nsmsg');m.classList.add('v');setTimeout(()=>m.classList.remove('v'),3000);}
async function testNotif(){const data=await api('/api/notifications/test',{method:'POST'});if(data.success)alert('‚úì Test sent! Check your iPhone.');else{const m=document.getElementById('nerrmsg');m.textContent='Error: '+(data.error||'Save Pushover keys first');m.classList.add('v');setTimeout(()=>m.classList.remove('v'),4000);}}

function renderFAQ(){
  const sections=[
    {title:'Getting Started',items:[
      {q:'How does the tracking work end to end?',a:'When someone clicks your ad, they land on your landing page. A tracking request fires to <code>/track/click</code> with a unique <code>click_id</code>. This click_id follows the visitor through to the offer. When they buy, the CPA network sends a postback to your <code>/postback</code> URL with that click_id + payout. Your tracker logs the sale, fires your pixels, and sends you a push notification.'},
      {q:'How do I connect my CPA network?',a:'Go to Postback URLs, copy your unique URL, and paste it into your network postback settings. For Adexico replace <code>{CLICK_ID}</code> with <code>{clickid}</code>, <code>{PAYOUT}</code> with <code>{payout}</code>, and <code>{TRANSACTION_ID}</code> with <code>{transaction_id}</code>.'},
      {q:'How do I track clicks on my landing page?',a:'Add this to your ad destination URL: <code>?click_id=UNIQUE_ID&source=meta&campaign=CAMP&ad=AD_ID&user_id=YOUR_UID</code>. Add a script on load that calls <code>/track/click</code> with those params. The click_id must also reach the offer checkout URL so the network returns it in the postback.'},
    ]},
    {title:'Platforms & Pixels',items:[
      {q:'How do I add multiple pixels for the same platform?',a:'Go to any platform page (Meta, TikTok, Google, Snapchat). Click Add New Pixel, give it a label like "Account 1" or "Brand B", paste the credentials, and save. You can add as many as you want. All pixels for that platform fire on every matching sale.'},
      {q:'What Google campaign types are supported?',a:'Search (keyword ads), Display (banner ads on websites), YouTube (video ads), Shopping (product listing ads), and Performance Max (PMax ‚Äî automated across all Google channels). Pass the type via <code>campaign_type=search</code> (or display / youtube / shopping / pmax) in your click tracking URL.'},
      {q:'How does Snapchat tracking work?',a:'Snapchat supports browser-side pixel (fires on page load) and server-side CAPI (fires from your server on confirmed sale). Add your Pixel ID and CAPI Access Token in the Snapchat page. The Snap Click ID is captured automatically from <code>?snapclid=</code> in the URL when someone clicks your Snap ad.'},
      {q:'How does Meta CAPI work vs browser pixel?',a:'Browser pixel fires in the visitor\'s browser (blocked by ad blockers). CAPI fires from your server directly to Meta ‚Äî it\'s more reliable, not blocked, and matches better. Your tracker uses CAPI only. You still need to keep your Meta pixel on the landing page for browser-side events like PageView and ViewContent.'},
    ]},
    {title:'Data & Reports',items:[
      {q:'What is AOV?',a:'Average Order Value ‚Äî the average payout per confirmed sale. Visible per user in the admin section and per offer in the ROI page.'},
      {q:'How do I calculate ROI?',a:'Go to ROI and click Add Spend. Enter your ad spend per offer. The platform matches spend to revenue by offer name and calculates profit and ROI%. To make this work accurately, use the same offer name in your postback URL and when entering spend.'},
      {q:'How do I export orders?',a:'Go to Orders, apply any date filter, then click CSV. All visible orders download as a spreadsheet with all fields.'},
      {q:'What does the Click Map show?',a:'Which campaigns and ads are getting clicks versus actually converting. CVR is color coded: green = 3%+ (good), orange = 1-3% (average), red = under 1% (poor). Use this to cut losing ads fast.'},
    ]},
    {title:'Team & Admin',items:[
      {q:'How do user roles work?',a:'First account created = Admin (sees all data from all users). Every account after = Member (sees only their own data). As admin you can view any user\'s stats from the Dashboard or Team & Users page.'},
      {q:'Can each user have their own pixels and notifications?',a:'Yes. Each user sets up their own pixels and Pushover keys. When a sale comes in with that user\'s click_id, only their pixels fire and only they get the push notification.'},
      {q:'How do I invite a team member?',a:'Share your platform URL. They click Sign Up and get assigned Member role automatically. Their postback URL includes their user ID so their data stays separate.'},
    ]},
    {title:'Notifications',items:[
      {q:'How do I get push notifications on my iPhone?',a:'Go to Notifications page. Create account at pushover.net, copy User Key and API Token. Download Pushover app on iPhone. Paste both keys, Save, then Send Test to verify. Every sale sends a push with cash register sound showing amount, platform, and campaign.'},
    ]},
  ];
  document.getElementById('faq-container').innerHTML=sections.map(s=>`
    <span class="faq-section-label">${s.title}</span>
    <div class="faq-list">
      ${s.items.map((item,i)=>`<div class="faq-item" id="fq-${s.title}-${i}"><div class="faq-q" onclick="toggleFAQ('fq-${s.title}-${i}')">${item.q}<span class="faq-arrow">‚ñº</span></div><div class="faq-a">${item.a}</div></div>`).join('')}
    </div>`).join('');
}

function toggleFAQ(id){document.getElementById(id).classList.toggle('open');}

async function init(){
  applyTheme();
  if(token){const me=await api('/api/auth/me');if(me.id){CU=me;showApp();}else localStorage.removeItem('tracker_token');}
}

init();
setInterval(()=>{if(curPage==='dashboard')loadDash();},30000);
</script>
</body>
</html>