<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Network Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600;700&family=Geist+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#080808;--s1:#0f0f0f;--s2:#141414;--s3:#1c1c1c;
    --border:#222;--border2:#2a2a2a;
    --text:#e8e8e8;--muted:#555;--muted2:#888;--white:#fff;
    --green:#00d084;--green-d:#00d08415;--green-b:#00d08430;
    --meta:#0082fb;--meta-d:#0082fb15;
    --tt:#ff2d55;--tt-d:#ff2d5515;
    --yt:#ff0000;--yt-d:#ff000015;
    --red:#ff4d4d;--red-d:#ff4d4d15;--red-b:#ff4d4d30;
    --orange:#ff9500;--orange-d:#ff950015;
    --sidebar-w:228px;
  }
  [data-theme="light"]{
    --bg:#f5f5f5;--s1:#ffffff;--s2:#f0f0f0;--s3:#e8e8e8;
    --border:#e0e0e0;--border2:#d0d0d0;
    --text:#1a1a1a;--muted:#aaa;--muted2:#777;--white:#1a1a1a;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--bg);color:var(--text);font-family:'Geist',sans-serif;min-height:100vh;-webkit-font-smoothing:antialiased;transition:background 0.2s,color 0.2s;}

  /* ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ */
  .login-page{display:none;min-height:100vh;align-items:center;justify-content:center;}
  .login-page.active{display:flex;}
  .login-box{width:100%;max-width:420px;padding:20px;}
  .login-logo{display:flex;align-items:center;gap:12px;margin-bottom:40px;justify-content:center;}
  .login-logo-mark{width:42px;height:42px;background:var(--green);border-radius:10px;display:flex;align-items:center;justify-content:center;}
  .login-logo-name{font-size:20px;font-weight:700;color:var(--white);}
  .login-card{background:var(--s1);border:1px solid var(--border);border-radius:16px;padding:32px;}
  .login-title{font-size:22px;font-weight:700;color:var(--white);margin-bottom:4px;}
  .login-sub{font-size:13px;color:var(--muted2);margin-bottom:24px;}
  .form-group{margin-bottom:14px;}
  .form-label{font-size:12px;color:var(--muted2);margin-bottom:5px;display:block;font-weight:500;}
  .form-input{width:100%;background:var(--s2);border:1px solid var(--border2);border-radius:8px;padding:10px 13px;font-size:14px;color:var(--text);font-family:'Geist',sans-serif;outline:none;transition:border-color 0.15s;}
  .form-input:focus{border-color:var(--green);}
  .form-input::placeholder{color:var(--muted);}
  .btn-primary{width:100%;background:var(--green);color:#000;border:none;border-radius:8px;padding:11px;font-size:14px;font-weight:600;cursor:pointer;font-family:'Geist',sans-serif;transition:opacity 0.15s;margin-top:6px;}
  .btn-primary:hover{opacity:0.88;}
  .btn-primary:disabled{opacity:0.5;cursor:not-allowed;}
  .login-switch{text-align:center;margin-top:18px;font-size:13px;color:var(--muted2);}
  .login-switch a{color:var(--green);text-decoration:none;cursor:pointer;}
  .form-error{font-size:12px;color:var(--red);margin-top:6px;display:none;}
  .form-error.visible{display:block;}

  /* ‚îÄ‚îÄ APP ‚îÄ‚îÄ */
  .app{display:none;}
  .app.active{display:flex;min-height:100vh;}

  /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
  .sidebar{position:fixed;left:0;top:0;bottom:0;width:var(--sidebar-w);background:var(--s1);border-right:1px solid var(--border);display:flex;flex-direction:column;padding:22px 0;z-index:100;transition:transform 0.25s;}
  .logo{padding:0 18px 20px;border-bottom:1px solid var(--border);margin-bottom:16px;}
  .logo-mark{width:30px;height:30px;background:var(--green);border-radius:7px;display:flex;align-items:center;justify-content:center;margin-bottom:8px;}
  .logo-name{font-size:13px;font-weight:700;color:var(--white);}
  .logo-sub{font-size:10px;color:var(--muted);font-family:'Geist Mono',monospace;}
  .nav{padding:0 8px;flex:1;overflow-y:auto;}
  .nav-section{font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);padding:12px 10px 5px;font-family:'Geist Mono',monospace;}
  .nav-item{display:flex;align-items:center;gap:9px;padding:8px 10px;border-radius:7px;font-size:12px;color:var(--muted2);cursor:pointer;transition:all 0.15s;margin-bottom:1px;font-weight:500;border:none;background:none;width:100%;text-align:left;}
  .nav-item:hover{background:var(--s2);color:var(--text);}
  .nav-item.active{background:var(--s2);color:var(--white);}
  .nav-icon{width:14px;height:14px;flex-shrink:0;opacity:0.6;}
  .nav-item.active .nav-icon,.nav-item:hover .nav-icon{opacity:1;}
  .live-dot{width:5px;height:5px;background:var(--green);border-radius:50%;margin-left:auto;animation:pulse 2s infinite;}
  .platform-dot-nav{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
  .sidebar-footer{padding:14px 18px 0;border-top:1px solid var(--border);}
  .user-info{display:flex;align-items:center;gap:9px;margin-bottom:10px;}
  .user-avatar{width:26px;height:26px;border-radius:50%;background:var(--green-d);border:1px solid var(--green-b);display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:var(--green);flex-shrink:0;}
  .user-name{font-size:12px;font-weight:500;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .user-role{font-size:10px;color:var(--muted);font-family:'Geist Mono',monospace;}
  .footer-actions{display:flex;gap:8px;align-items:center;}
  .logout-btn{font-size:11px;color:var(--muted);background:none;border:none;cursor:pointer;font-family:'Geist',sans-serif;padding:0;}
  .logout-btn:hover{color:var(--red);}
  .theme-btn{width:24px;height:24px;border-radius:6px;border:1px solid var(--border);background:var(--s2);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;margin-left:auto;}

  /* ‚îÄ‚îÄ MOBILE MENU ‚îÄ‚îÄ */
  .mobile-bar{display:none;position:fixed;top:0;left:0;right:0;height:52px;background:var(--s1);border-bottom:1px solid var(--border);z-index:200;align-items:center;padding:0 16px;gap:12px;}
  .hamburger{width:32px;height:32px;border-radius:7px;border:1px solid var(--border);background:var(--s2);display:flex;align-items:center;justify-content:center;cursor:pointer;flex-direction:column;gap:4px;padding:8px;}
  .hamburger span{display:block;width:14px;height:1.5px;background:var(--muted2);border-radius:1px;}
  .mobile-title{font-size:14px;font-weight:600;color:var(--white);}
  .overlay{display:none;position:fixed;inset:0;background:#00000060;z-index:99;}
  .overlay.visible{display:block;}

  /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
  .main{margin-left:var(--sidebar-w);flex:1;display:flex;flex-direction:column;}
  .topbar{height:52px;border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 24px;gap:10px;background:var(--bg);position:sticky;top:0;z-index:50;}
  .topbar-title{font-size:14px;font-weight:600;color:var(--white);flex:1;}
  .topbar-date{font-size:11px;color:var(--muted2);font-family:'Geist Mono',monospace;}
  .icon-btn{width:28px;height:28px;border-radius:6px;border:1px solid var(--border2);background:var(--s2);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--muted2);transition:all 0.15s;font-size:12px;}
  .icon-btn:hover{border-color:var(--green);color:var(--green);}
  .content{padding:24px;flex:1;}

  /* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
  .page{display:none;}
  .page.active{display:block;animation:fadeIn 0.25s ease;}

  /* ‚îÄ‚îÄ STATS GRID ‚îÄ‚îÄ */
  .stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:18px;}
  .stat-card{background:var(--s1);border:1px solid var(--border);border-radius:11px;padding:16px;}
  .stat-label{font-size:11px;color:var(--muted2);font-weight:500;margin-bottom:9px;}
  .stat-value{font-size:24px;font-weight:700;color:var(--white);letter-spacing:-0.8px;line-height:1;margin-bottom:5px;font-variant-numeric:tabular-nums;}
  .stat-value .currency{font-size:13px;font-weight:500;color:var(--muted2);}
  .stat-change{font-size:11px;font-family:'Geist Mono',monospace;}
  .up{color:var(--green);}
  .down{color:var(--red);}
  .neutral{color:var(--muted2);}

  /* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
  .section-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:18px;}
  .card{background:var(--s1);border:1px solid var(--border);border-radius:11px;overflow:hidden;}
  .card-header{padding:14px 16px 11px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;}
  .card-title{font-size:13px;font-weight:600;color:var(--white);}
  .card-badge{font-size:10px;font-family:'Geist Mono',monospace;color:var(--muted2);background:var(--s2);border:1px solid var(--border);padding:2px 7px;border-radius:4px;white-space:nowrap;}
  .card-body{padding:14px 16px;}

  /* ‚îÄ‚îÄ PLATFORM BARS ‚îÄ‚îÄ */
  .platform-list{display:flex;flex-direction:column;gap:11px;}
  .platform-row{display:grid;grid-template-columns:85px 1fr 65px;align-items:center;gap:10px;}
  .platform-info{display:flex;align-items:center;gap:7px;}
  .platform-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
  .platform-name{font-size:12px;font-weight:500;color:var(--text);}
  .bar-track{height:3px;background:var(--s3);border-radius:2px;overflow:hidden;}
  .bar-fill{height:100%;border-radius:2px;transition:width 1s cubic-bezier(0.4,0,0.2,1);}
  .platform-amount{font-size:11px;font-weight:600;color:var(--white);text-align:right;font-family:'Geist Mono',monospace;}

  /* ‚îÄ‚îÄ CONVERSION ‚îÄ‚îÄ */
  .conv-big{display:flex;align-items:flex-end;gap:5px;margin-bottom:10px;}
  .conv-number{font-size:40px;font-weight:700;color:var(--white);letter-spacing:-2px;line-height:1;}
  .conv-pct{font-size:16px;color:var(--muted2);margin-bottom:3px;}
  .conv-desc{font-size:11px;color:var(--muted2);margin-bottom:12px;}
  .conv-bar-label{display:flex;justify-content:space-between;font-size:10px;color:var(--muted2);font-family:'Geist Mono',monospace;margin-bottom:5px;}
  .conv-track{height:4px;background:var(--s3);border-radius:2px;overflow:hidden;}
  .conv-fill{height:100%;background:linear-gradient(90deg,var(--green),#00ffaa);border-radius:2px;transition:width 1.2s cubic-bezier(0.4,0,0.2,1);}

  /* ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ */
  .filters{display:flex;align-items:center;gap:6px;margin-bottom:14px;flex-wrap:wrap;}
  .filter-btn{padding:6px 12px;border-radius:7px;border:1px solid var(--border);background:var(--s1);color:var(--muted2);font-size:11px;font-weight:500;cursor:pointer;font-family:'Geist',sans-serif;transition:all 0.15s;}
  .filter-btn:hover{border-color:var(--border2);color:var(--text);}
  .filter-btn.active{background:var(--green-d);border-color:var(--green-b);color:var(--green);}

  /* ‚îÄ‚îÄ SEARCH BAR ‚îÄ‚îÄ */
  .search-bar{display:flex;align-items:center;gap:8px;margin-bottom:14px;}
  .search-input{flex:1;background:var(--s1);border:1px solid var(--border);border-radius:8px;padding:8px 13px;font-size:13px;color:var(--text);font-family:'Geist',sans-serif;outline:none;transition:border-color 0.15s;}
  .search-input:focus{border-color:var(--green);}
  .search-input::placeholder{color:var(--muted);}
  .export-btn{padding:8px 14px;border-radius:8px;border:1px solid var(--border);background:var(--s1);color:var(--muted2);font-size:12px;font-weight:500;cursor:pointer;font-family:'Geist',sans-serif;transition:all 0.15s;white-space:nowrap;}
  .export-btn:hover{border-color:var(--green);color:var(--green);}

  /* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
  .table-card{background:var(--s1);border:1px solid var(--border);border-radius:11px;overflow:hidden;margin-bottom:18px;}
  .table-wrap{overflow-x:auto;}
  table{width:100%;border-collapse:collapse;}
  thead th{padding:10px 13px;font-size:10px;font-weight:500;color:var(--muted2);text-align:left;border-bottom:1px solid var(--border);font-family:'Geist Mono',monospace;letter-spacing:0.5px;text-transform:uppercase;white-space:nowrap;}
  tbody tr{border-bottom:1px solid var(--border);transition:background 0.1s;}
  tbody tr:last-child{border-bottom:none;}
  tbody tr:hover{background:var(--s2);}
  tbody td{padding:11px 13px;font-size:12px;white-space:nowrap;}
  .platform-tag{display:inline-flex;align-items:center;gap:4px;font-size:10px;font-weight:500;padding:2px 7px;border-radius:4px;}
  .tag-meta{background:var(--meta-d);color:var(--meta);border:1px solid #0082fb25;}
  .tag-tt{background:var(--tt-d);color:var(--tt);border:1px solid #ff2d5525;}
  .tag-yt{background:var(--yt-d);color:var(--yt);border:1px solid #ff000025;}
  .tag-dot{width:4px;height:4px;border-radius:50%;background:currentColor;}
  .payout-cell{font-weight:600;color:var(--green);font-family:'Geist Mono',monospace;}
  .status-badge{display:inline-flex;align-items:center;gap:4px;font-size:10px;padding:2px 7px;border-radius:4px;background:var(--green-d);color:var(--green);border:1px solid var(--green-b);font-family:'Geist Mono',monospace;}
  .time-cell{font-family:'Geist Mono',monospace;font-size:11px;color:var(--muted2);}
  .id-cell{font-family:'Geist Mono',monospace;font-size:10px;color:var(--muted2);}
  .pixel-cell{display:flex;gap:3px;}
  .pixel-dot{width:16px;height:16px;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:8px;font-weight:700;}
  .pixel-on{background:var(--green-d);color:var(--green);border:1px solid var(--green-b);}
  .pixel-off{background:var(--s3);color:var(--muted);border:1px solid var(--border);}

  /* ‚îÄ‚îÄ POSTBACK PAGE ‚îÄ‚îÄ */
  .postback-hero{background:var(--s1);border:1px solid var(--border);border-radius:11px;padding:24px;margin-bottom:14px;}
  .postback-title{font-size:16px;font-weight:700;color:var(--white);margin-bottom:6px;}
  .postback-sub{font-size:13px;color:var(--muted2);margin-bottom:20px;line-height:1.7;}
  .postback-url-box{background:var(--s2);border:1px solid var(--border2);border-radius:8px;padding:14px 16px;font-family:'Geist Mono',monospace;font-size:12px;color:var(--green);word-break:break-all;line-height:1.7;margin-bottom:12px;}
  .copy-btn{display:inline-flex;align-items:center;gap:6px;padding:9px 16px;border-radius:8px;border:1px solid var(--green-b);background:var(--green-d);color:var(--green);font-size:12px;font-weight:600;cursor:pointer;font-family:'Geist',sans-serif;transition:all 0.15s;}
  .copy-btn:hover{background:var(--green);color:#000;}
  .copy-success{font-size:11px;color:var(--green);margin-left:10px;opacity:0;transition:opacity 0.3s;}
  .copy-success.visible{opacity:1;}
  .macro-table{width:100%;border-collapse:collapse;margin-top:16px;}
  .macro-table td{padding:8px 12px;font-size:12px;border-bottom:1px solid var(--border);}
  .macro-table tr:last-child td{border-bottom:none;}
  .macro-table td:first-child{font-family:'Geist Mono',monospace;color:var(--green);width:180px;}
  .macro-table td:last-child{color:var(--muted2);}

  /* ‚îÄ‚îÄ NOTIFICATIONS PAGE ‚îÄ‚îÄ */
  .notif-card{background:var(--s1);border:1px solid var(--border);border-radius:11px;padding:24px;margin-bottom:14px;}
  .notif-title{font-size:15px;font-weight:700;color:var(--white);margin-bottom:4px;}
  .notif-sub{font-size:12px;color:var(--muted2);margin-bottom:20px;line-height:1.7;}
  .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px;}
  .btn-save{background:var(--green);color:#000;border:none;border-radius:7px;padding:9px 18px;font-size:12px;font-weight:600;cursor:pointer;font-family:'Geist',sans-serif;}
  .btn-save:hover{opacity:0.88;}
  .btn-secondary{background:var(--s2);color:var(--text);border:1px solid var(--border2);border-radius:7px;padding:9px 18px;font-size:12px;font-weight:500;cursor:pointer;font-family:'Geist',sans-serif;margin-left:8px;}
  .success-msg{font-size:12px;color:var(--green);margin-top:8px;display:none;}
  .success-msg.visible{display:block;}

  /* ‚îÄ‚îÄ PIXEL SETTINGS ‚îÄ‚îÄ */
  .pixel-form-card{background:var(--s1);border:1px solid var(--border);border-radius:11px;padding:24px;margin-bottom:14px;}

  /* ‚îÄ‚îÄ ROI PAGE ‚îÄ‚îÄ */
  .roi-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:10px;margin-bottom:18px;}
  .roi-card{background:var(--s1);border:1px solid var(--border);border-radius:11px;padding:16px;}
  .roi-offer{font-size:13px;font-weight:600;color:var(--white);margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .roi-platform{display:inline-flex;align-items:center;gap:5px;font-size:10px;font-weight:500;padding:2px 7px;border-radius:4px;margin-bottom:12px;}
  .roi-stats{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px;}
  .roi-stat{background:var(--s2);border-radius:6px;padding:8px;text-align:center;}
  .roi-stat-val{font-size:13px;font-weight:600;font-family:'Geist Mono',monospace;}
  .roi-stat-label{font-size:10px;color:var(--muted2);margin-top:2px;}
  .roi-profit{padding:8px 10px;border-radius:7px;text-align:center;font-size:13px;font-weight:700;font-family:'Geist Mono',monospace;}
  .roi-profit.positive{background:var(--green-d);color:var(--green);border:1px solid var(--green-b);}
  .roi-profit.negative{background:var(--red-d);color:var(--red);border:1px solid var(--red-b);}
  .roi-profit.neutral{background:var(--s3);color:var(--muted2);border:1px solid var(--border);}

  /* ‚îÄ‚îÄ CLICK MAP ‚îÄ‚îÄ */
  .clickmap-row{display:grid;grid-template-columns:1fr 80px 80px 80px 80px;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--border);}
  .clickmap-row:last-child{border-bottom:none;}
  .cm-campaign{font-size:12px;font-weight:500;color:var(--white);}
  .cm-ad{font-size:10px;color:var(--muted2);font-family:'Geist Mono',monospace;margin-top:2px;}
  .cm-num{font-size:12px;font-weight:600;text-align:right;font-family:'Geist Mono',monospace;}

  /* ‚îÄ‚îÄ ANALYTICS ‚îÄ‚îÄ */
  .analytics-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(270px,1fr));gap:10px;margin-bottom:18px;}
  .analytics-card{background:var(--s1);border:1px solid var(--border);border-radius:11px;padding:15px;}
  .ac-platform{display:inline-flex;align-items:center;gap:4px;font-size:10px;font-weight:500;padding:2px 7px;border-radius:4px;margin-bottom:10px;}
  .ac-offer{font-size:13px;font-weight:600;color:var(--white);margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .ac-url{font-size:10px;color:var(--muted2);font-family:'Geist Mono',monospace;margin-bottom:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .ac-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;}
  .ac-stat{background:var(--s2);border-radius:5px;padding:6px;text-align:center;}
  .ac-stat-val{font-size:13px;font-weight:600;color:var(--white);font-family:'Geist Mono',monospace;}
  .ac-stat-label{font-size:9px;color:var(--muted2);margin-top:2px;}
  .ac-meta{display:flex;gap:5px;margin-top:8px;flex-wrap:wrap;}
  .ac-chip{font-size:9px;padding:2px 6px;border-radius:3px;background:var(--s3);color:var(--muted2);font-family:'Geist Mono',monospace;}

  /* ‚îÄ‚îÄ EMPTY ‚îÄ‚îÄ */
  .empty-state{padding:40px;text-align:center;}
  .empty-icon{font-size:28px;margin-bottom:10px;opacity:0.3;}
  .empty-title{font-size:13px;font-weight:500;color:var(--muted2);margin-bottom:5px;}
  .empty-sub{font-size:11px;color:var(--muted);}

  /* ‚îÄ‚îÄ ADD SPEND MODAL ‚îÄ‚îÄ */
  .modal-overlay{display:none;position:fixed;inset:0;background:#00000070;z-index:300;align-items:center;justify-content:center;}
  .modal-overlay.visible{display:flex;}
  .modal{background:var(--s1);border:1px solid var(--border);border-radius:14px;padding:24px;width:100%;max-width:420px;margin:20px;}
  .modal-title{font-size:15px;font-weight:700;color:var(--white);margin-bottom:4px;}
  .modal-sub{font-size:12px;color:var(--muted2);margin-bottom:18px;}
  .modal-footer{display:flex;gap:8px;margin-top:16px;}
  .btn-cancel{background:var(--s2);color:var(--muted2);border:1px solid var(--border);border-radius:7px;padding:9px 16px;font-size:12px;cursor:pointer;font-family:'Geist',sans-serif;}

  @keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.4;}}
  @keyframes fadeIn{from{opacity:0;transform:translateY(5px);}to{opacity:1;transform:translateY(0);}}

  @media(max-width:900px){
    .stats-grid{grid-template-columns:repeat(2,1fr);}
    .section-row{grid-template-columns:1fr;}
    .form-row{grid-template-columns:1fr;}
  }
  @media(max-width:700px){
    .sidebar{transform:translateX(-100%);}
    .sidebar.open{transform:translateX(0);}
    .main{margin-left:0;padding-top:52px;}
    .mobile-bar{display:flex;}
    .topbar{display:none;}
    .stats-grid{grid-template-columns:1fr 1fr;}
    .content{padding:16px;}
    .clickmap-row{grid-template-columns:1fr 60px 60px;}
  }
</style>
</head>
<body>

<!-- LOGIN -->
<div class="login-page active" id="login-page">
  <div class="login-box">
    <div class="login-logo">
      <div class="login-logo-mark">
        <svg width="22" height="22" viewBox="0 0 20 20" fill="none"><path d="M10 2L17 6V14L10 18L3 14V6L10 2Z" fill="#080808"/></svg>
      </div>
      <div class="login-logo-name">Network Tracker</div>
    </div>
    <div class="login-card">
      <div id="login-form">
        <div class="login-title">Welcome back</div>
        <div class="login-sub">Sign in to your account</div>
        <div class="form-group"><label class="form-label">Email</label><input class="form-input" type="email" id="login-email" placeholder="you@example.com"></div>
        <div class="form-group"><label class="form-label">Password</label><input class="form-input" type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter')login()"></div>
        <div class="form-error" id="login-error"></div>
        <button class="btn-primary" onclick="login()">Sign in</button>
        <div class="login-switch">No account? <a onclick="showSignup()">Sign up</a></div>
      </div>
      <div id="signup-form" style="display:none">
        <div class="login-title">Create account</div>
        <div class="login-sub">First account created becomes admin</div>
        <div class="form-group"><label class="form-label">Full Name</label><input class="form-input" type="text" id="signup-name" placeholder="Your name"></div>
        <div class="form-group"><label class="form-label">Email</label><input class="form-input" type="email" id="signup-email" placeholder="you@example.com"></div>
        <div class="form-group"><label class="form-label">Password</label><input class="form-input" type="password" id="signup-password" placeholder="Min 6 characters"></div>
        <div class="form-error" id="signup-error"></div>
        <button class="btn-primary" onclick="signup()">Create account</button>
        <div class="login-switch">Have an account? <a onclick="showLogin()">Sign in</a></div>
      </div>
    </div>
  </div>
</div>

<!-- APP -->
<div class="app" id="app">
  <!-- MOBILE BAR -->
  <div class="mobile-bar">
    <div class="hamburger" onclick="toggleSidebar()"><span></span><span></span><span></span></div>
    <div class="mobile-title" id="mobile-title">Dashboard</div>
    <div class="icon-btn" onclick="toggleTheme()" style="margin-left:auto">üåô</div>
  </div>
  <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

  <!-- SIDEBAR -->
  <nav class="sidebar" id="sidebar">
    <div class="logo">
      <div class="logo-mark"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M8 1L14 4.5V11.5L8 15L2 11.5V4.5L8 1Z" fill="#080808"/></svg></div>
      <div class="logo-name">Network Tracker</div>
      <div class="logo-sub">v3.0.0</div>
    </div>
    <div class="nav">
      <div class="nav-section">Main</div>
      <button class="nav-item active" onclick="showPage('dashboard',this)">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="1" y="1" width="6" height="6" rx="1"/><rect x="9" y="1" width="6" height="6" rx="1"/><rect x="1" y="9" width="6" height="6" rx="1"/><rect x="9" y="9" width="6" height="6" rx="1"/></svg>
        Dashboard <div class="live-dot"></div>
      </button>

      <div class="nav-section">Platforms</div>
      <button class="nav-item" onclick="showPage('pixels-meta',this)">
        <div class="platform-dot-nav" style="background:var(--meta)"></div>Meta
      </button>
      <button class="nav-item" onclick="showPage('pixels-youtube',this)">
        <div class="platform-dot-nav" style="background:var(--yt)"></div>YouTube
      </button>
      <button class="nav-item" onclick="showPage('pixels-tiktok',this)">
        <div class="platform-dot-nav" style="background:var(--tt)"></div>TikTok
      </button>

      <div class="nav-section">Data</div>
      <button class="nav-item" onclick="showPage('orders',this)">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 4H14M4 8H12M6 12H10"/></svg>
        Orders
      </button>
      <button class="nav-item" onclick="showPage('analytics',this)">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12L5 8L8 10L11 5L14 8"/><path d="M2 2V14H14"/></svg>
        Analytics
      </button>
      <button class="nav-item" onclick="showPage('clickmap',this)">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6.5"/><path d="M8 4v4l3 2"/></svg>
        Click Map
      </button>
      <button class="nav-item" onclick="showPage('roi',this)">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 13L6 8l3 3 5-7"/></svg>
        ROI
      </button>

      <div class="nav-section">Settings</div>
      <button class="nav-item" onclick="showPage('postback',this)">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M13 8H3M8 3l-5 5 5 5"/></svg>
        Postback URLs
      </button>
      <button class="nav-item" onclick="showPage('notifications',this)">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M8 14c.55 0 1-.45 1-1H7c0 .55.45 1 1 1zm5-3V7c0-2.76-1.86-5.07-4.5-5.69V1c0-.55-.45-1-1-1s-1 .45-1 1v.31C3.86 1.93 2 4.24 2 7v4l-1 1v1h14v-1l-1-1z"/></svg>
        Notifications
      </button>
    </div>
    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-avatar" id="user-avatar">?</div>
        <div style="overflow:hidden">
          <div class="user-name" id="user-name">Loading...</div>
          <div class="user-role" id="user-role">member</div>
        </div>
      </div>
      <div class="footer-actions">
        <button class="logout-btn" onclick="logout()">Sign out</button>
        <div class="theme-btn icon-btn" onclick="toggleTheme()" id="theme-icon">üåô</div>
      </div>
    </div>
  </nav>

  <!-- MAIN -->
  <div class="main">
    <div class="topbar">
      <div class="topbar-title" id="page-title">Dashboard</div>
      <div class="topbar-date" id="current-date"></div>
      <div class="icon-btn" onclick="refreshPage()">‚Üª</div>
    </div>
    <div class="content">

      <!-- DASHBOARD -->
      <div class="page active" id="page-dashboard">
        <div class="stats-grid">
          <div class="stat-card"><div class="stat-label">Revenue Today</div><div class="stat-value" id="revenue-today"><span class="currency">$</span>0.00</div><div class="stat-change neutral" id="revenue-change">‚Äì</div></div>
          <div class="stat-card"><div class="stat-label">Orders Today</div><div class="stat-value" id="orders-today">0</div><div class="stat-change neutral" id="orders-change">‚Äì</div></div>
          <div class="stat-card"><div class="stat-label">Total Revenue</div><div class="stat-value" id="revenue-total"><span class="currency">$</span>0.00</div><div class="stat-change neutral" id="total-label">‚Äì</div></div>
          <div class="stat-card"><div class="stat-label">Conversion Rate</div><div class="stat-value" id="conv-rate">0%</div><div class="stat-change neutral" id="conv-label">‚Äì</div></div>
        </div>
        <div class="section-row">
          <div class="card">
            <div class="card-header"><div class="card-title">Revenue by Platform</div><div class="card-badge">Today</div></div>
            <div class="card-body">
              <div class="platform-list" id="platform-list">
                <div class="platform-row"><div class="platform-info"><div class="platform-dot" style="background:var(--meta)"></div><div class="platform-name">Meta</div></div><div class="bar-track"><div class="bar-fill" style="width:0%;background:var(--meta)"></div></div><div class="platform-amount">$0.00</div></div>
                <div class="platform-row"><div class="platform-info"><div class="platform-dot" style="background:var(--yt)"></div><div class="platform-name">YouTube</div></div><div class="bar-track"><div class="bar-fill" style="width:0%;background:var(--yt)"></div></div><div class="platform-amount">$0.00</div></div>
                <div class="platform-row"><div class="platform-info"><div class="platform-dot" style="background:var(--tt)"></div><div class="platform-name">TikTok</div></div><div class="bar-track"><div class="bar-fill" style="width:0%;background:var(--tt)"></div></div><div class="platform-amount">$0.00</div></div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header"><div class="card-title">Conversion Rate</div><div class="card-badge">Clicks ‚Üí Orders</div></div>
            <div class="card-body">
              <div class="conv-big"><div class="conv-number" id="conv-big">0</div><div class="conv-pct">%</div></div>
              <div class="conv-desc" id="conv-desc">No data yet</div>
              <div class="conv-bar-label"><span>0%</span><span id="conv-bar-right">0%</span></div>
              <div class="conv-track"><div class="conv-fill" id="conv-fill" style="width:0%"></div></div>
            </div>
          </div>
        </div>
        <div class="table-card">
          <div class="card-header"><div class="card-title">Recent Orders</div><div class="card-badge" id="recent-badge">0 today</div></div>
          <div class="table-wrap"><table><thead><tr><th>Transaction ID</th><th>Platform</th><th>Campaign</th><th>Payout</th><th>Pixels</th><th>Time</th></tr></thead><tbody id="dashboard-tbody"><tr><td colspan="6"><div class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-title">No orders yet</div></div></td></tr></tbody></table></div>
        </div>
      </div>

      <!-- ORDERS -->
      <div class="page" id="page-orders">
        <div class="filters">
          <button class="filter-btn active" onclick="filterOrders('all',this)">All Time</button>
          <button class="filter-btn" onclick="filterOrders('today',this)">Today</button>
          <button class="filter-btn" onclick="filterOrders('yesterday',this)">Yesterday</button>
          <button class="filter-btn" onclick="filterOrders('7days',this)">7 Days</button>
          <button class="filter-btn" onclick="filterOrders('30days',this)">30 Days</button>
        </div>
        <div class="search-bar">
          <input class="search-input" type="text" id="order-search" placeholder="Search by transaction ID..." oninput="searchOrders()">
          <button class="export-btn" onclick="exportCSV()">‚¨á Export CSV</button>
        </div>
        <div class="table-card">
          <div class="card-header"><div class="card-title">Orders</div><div class="card-badge" id="orders-badge">‚Äì</div></div>
          <div class="table-wrap"><table><thead><tr><th>Transaction ID</th><th>Platform</th><th>Offer</th><th>Campaign</th><th>Country</th><th>Device</th><th>Payout</th><th>Network</th><th>Time</th></tr></thead><tbody id="orders-tbody"><tr><td colspan="9"><div class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-title">No orders yet</div></div></td></tr></tbody></table></div>
        </div>
      </div>

      <!-- ANALYTICS -->
      <div class="page" id="page-analytics">
        <div class="filters">
          <button class="filter-btn active" onclick="filterAnalytics('30days',this)">30 Days</button>
          <button class="filter-btn" onclick="filterAnalytics('today',this)">Today</button>
          <button class="filter-btn" onclick="filterAnalytics('yesterday',this)">Yesterday</button>
          <button class="filter-btn" onclick="filterAnalytics('7days',this)">7 Days</button>
        </div>
        <div class="analytics-grid" id="analytics-grid"><div class="empty-state"><div class="empty-icon">üìä</div><div class="empty-title">No data yet</div></div></div>
      </div>

      <!-- CLICK MAP -->
      <div class="page" id="page-clickmap">
        <div class="filters">
          <button class="filter-btn active" onclick="filterClickmap('7days',this)">7 Days</button>
          <button class="filter-btn" onclick="filterClickmap('today',this)">Today</button>
          <button class="filter-btn" onclick="filterClickmap('30days',this)">30 Days</button>
        </div>
        <div class="table-card">
          <div class="card-header">
            <div class="card-title">Clicks vs Conversions by Ad</div>
            <div class="card-badge">Campaign ‚Üí Ad level</div>
          </div>
          <div class="card-body">
            <div style="display:grid;grid-template-columns:1fr 80px 80px 80px 80px;gap:10px;padding-bottom:8px;border-bottom:1px solid var(--border);margin-bottom:4px;">
              <div style="font-size:10px;font-family:'Geist Mono',monospace;color:var(--muted2);text-transform:uppercase;letter-spacing:1px;">Campaign / Ad</div>
              <div style="font-size:10px;font-family:'Geist Mono',monospace;color:var(--muted2);text-align:right;text-transform:uppercase;letter-spacing:1px;">Clicks</div>
              <div style="font-size:10px;font-family:'Geist Mono',monospace;color:var(--muted2);text-align:right;text-transform:uppercase;letter-spacing:1px;">Sales</div>
              <div style="font-size:10px;font-family:'Geist Mono',monospace;color:var(--muted2);text-align:right;text-transform:uppercase;letter-spacing:1px;">CVR</div>
              <div style="font-size:10px;font-family:'Geist Mono',monospace;color:var(--muted2);text-align:right;text-transform:uppercase;letter-spacing:1px;">Revenue</div>
            </div>
            <div id="clickmap-list"><div class="empty-state"><div class="empty-icon">üó∫</div><div class="empty-title">No click data yet</div></div></div>
          </div>
        </div>
      </div>

      <!-- ROI -->
      <div class="page" id="page-roi">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px;">
          <div class="filters" style="margin-bottom:0;flex:1">
            <button class="filter-btn active" onclick="filterROI('30days',this)">30 Days</button>
            <button class="filter-btn" onclick="filterROI('today',this)">Today</button>
            <button class="filter-btn" onclick="filterROI('7days',this)">7 Days</button>
          </div>
          <button class="export-btn" onclick="document.getElementById('spend-modal').classList.add('visible')">+ Add Spend</button>
        </div>
        <div class="roi-grid" id="roi-grid"><div class="empty-state"><div class="empty-icon">üí∞</div><div class="empty-title">No ROI data yet</div><div class="empty-sub">Add ad spend to calculate profit</div></div></div>
      </div>

      <!-- POSTBACK -->
      <div class="page" id="page-postback">
        <div class="postback-hero">
          <div class="postback-title">Your Postback URL</div>
          <div class="postback-sub">Copy this URL and paste it into your CPA network's postback/conversion URL settings. Every time a sale is confirmed, the network will call this URL and your tracker will record it.</div>
          <div class="postback-url-box" id="postback-url-display">Loading your URL...</div>
          <button class="copy-btn" onclick="copyPostback()">üìã Copy URL</button>
          <span class="copy-success" id="copy-success">‚úì Copied!</span>
        </div>
        <div class="card">
          <div class="card-header"><div class="card-title">Available Macros</div><div class="card-badge">Replace with network placeholders</div></div>
          <div class="card-body">
            <table class="macro-table">
              <tr><td>{CLICK_ID}</td><td>Your tracking click ID ‚Äî must be passed through from your landing page</td></tr>
              <tr><td>{PAYOUT}</td><td>Sale payout amount (e.g. 45.00)</td></tr>
              <tr><td>{TRANSACTION_ID}</td><td>Network's unique transaction/order ID</td></tr>
              <tr><td>{OFFER_ID}</td><td>Offer ID from the network</td></tr>
              <tr><td>{OFFER_NAME}</td><td>Offer name (optional but recommended)</td></tr>
              <tr><td>{COUNTRY}</td><td>Buyer's country code (optional)</td></tr>
            </table>
            <div style="margin-top:16px;padding:12px;background:var(--s2);border-radius:8px;font-size:12px;color:var(--muted2);line-height:1.7">
              <strong style="color:var(--text)">Network-specific macro formats:</strong><br>
              Adexico: <span style="font-family:'Geist Mono',monospace;color:var(--green)">{clickid}</span> ¬∑ <span style="font-family:'Geist Mono',monospace;color:var(--green)">{payout}</span> ¬∑ <span style="font-family:'Geist Mono',monospace;color:var(--green)">{transaction_id}</span><br>
              Most networks: check their postback documentation for exact macro names
            </div>
          </div>
        </div>
      </div>

      <!-- NOTIFICATIONS -->
      <div class="page" id="page-notifications">
        <div class="notif-card">
          <div class="notif-title">üîî Push Notifications</div>
          <div class="notif-sub">Get a push notification on your iPhone every time a sale comes in. Uses Pushover ‚Äî free app, takes 5 minutes to set up.</div>
          <div class="form-row">
            <div class="form-group"><label class="form-label">Pushover User Key</label><input class="form-input" type="text" id="notif-user-key" placeholder="Your Pushover user key"></div>
            <div class="form-group"><label class="form-label">Pushover API Token</label><input class="form-input" type="text" id="notif-api-token" placeholder="Your app API token"></div>
          </div>
          <button class="btn-save" onclick="saveNotifications()">Save Settings</button>
          <button class="btn-secondary" onclick="testNotification()">Send Test</button>
          <div class="success-msg" id="notif-success">‚úì Saved ‚Äî you'll receive a push notification for every sale</div>
        </div>
        <div class="card">
          <div class="card-header"><div class="card-title">How to set up Pushover</div></div>
          <div class="card-body" style="font-size:13px;color:var(--muted2);line-height:2">
            1. Go to <strong style="color:var(--text)">pushover.net</strong> and create a free account<br>
            2. Copy your <strong style="color:var(--text)">User Key</strong> from the dashboard<br>
            3. Click "Create an Application" ‚Üí name it "My Tracker" ‚Üí copy the <strong style="color:var(--text)">API Token</strong><br>
            4. Download <strong style="color:var(--text)">Pushover</strong> on your iPhone and log in<br>
            5. Paste both keys above and click Save
          </div>
        </div>
      </div>

      <!-- PIXEL PAGES -->
      <div class="page" id="page-pixels-meta"><div id="pf-meta"></div></div>
      <div class="page" id="page-pixels-youtube"><div id="pf-youtube"></div></div>
      <div class="page" id="page-pixels-tiktok"><div id="pf-tiktok"></div></div>

    </div>
  </div>
</div>

<!-- ADD SPEND MODAL -->
<div class="modal-overlay" id="spend-modal">
  <div class="modal">
    <div class="modal-title">Add Ad Spend</div>
    <div class="modal-sub">Enter how much you spent on this campaign to calculate ROI</div>
    <div class="form-group"><label class="form-label">Platform</label>
      <select class="form-input" id="spend-platform"><option value="meta">Meta</option><option value="youtube">YouTube</option><option value="tiktok">TikTok</option></select>
    </div>
    <div class="form-group"><label class="form-label">Campaign ID</label><input class="form-input" type="text" id="spend-campaign" placeholder="e.g. Summer_v3"></div>
    <div class="form-group"><label class="form-label">Offer Name</label><input class="form-input" type="text" id="spend-offer" placeholder="e.g. Product X"></div>
    <div class="form-group"><label class="form-label">Amount Spent ($)</label><input class="form-input" type="number" id="spend-amount" placeholder="e.g. 250.00"></div>
    <div class="form-group"><label class="form-label">Date</label><input class="form-input" type="date" id="spend-date"></div>
    <div class="modal-footer">
      <button class="btn-save" onclick="saveSpend()">Save Spend</button>
      <button class="btn-cancel" onclick="document.getElementById('spend-modal').classList.remove('visible')">Cancel</button>
    </div>
  </div>
</div>

<script>
  // ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
  let token = localStorage.getItem('tracker_token');
  let currentUser = null;
  let currentPage = 'dashboard';
  let currentOrderPeriod = 'all';
  let currentAnalyticsPeriod = '30days';
  let currentClickmapPeriod = '7days';
  let currentROIPeriod = '30days';
  let allOrders = [];
  let pixelData = {};
  let isDark = localStorage.getItem('theme') !== 'light';

  const PC = {
    meta:    {color:'#0082fb',label:'Meta',    tag:'tag-meta',icon:'üìò'},
    facebook:{color:'#0082fb',label:'Meta',    tag:'tag-meta',icon:'üìò'},
    youtube: {color:'#ff0000',label:'YouTube', tag:'tag-yt',  icon:'‚ñ∂Ô∏è'},
    tiktok:  {color:'#ff2d55',label:'TikTok',  tag:'tag-tt',  icon:'üéµ'},
    unknown: {color:'#888',   label:'Unknown', tag:'',        icon:'‚ùì'}
  };

  function gp(s){
    const v=(s||'').toLowerCase();
    if(v.includes('meta')||v.includes('facebook')||v.includes('fb'))return 'meta';
    if(v.includes('youtube')||v.includes('yt')||v.includes('google'))return 'youtube';
    if(v.includes('tiktok')||v.includes('tt'))return 'tiktok';
    return 'unknown';
  }

  function fmt(n){return parseFloat(n||0).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});}

  function timeAgo(d){
    const diff=(Date.now()-new Date(d))/1000;
    if(diff<60)return 'just now';
    if(diff<3600)return `${Math.floor(diff/60)}m ago`;
    if(diff<86400)return `${Math.floor(diff/3600)}h ago`;
    return new Date(d).toLocaleDateString('en-US',{month:'short',day:'numeric'});
  }

  async function api(url,opts={}){
    const res=await fetch(url,{...opts,headers:{'Content-Type':'application/json','Authorization':`Bearer ${token}`,...(opts.headers||{})}});
    return res.json();
  }

  // ‚îÄ‚îÄ THEME ‚îÄ‚îÄ
  function toggleTheme(){
    isDark=!isDark;
    document.body.setAttribute('data-theme',isDark?'':'light');
    localStorage.setItem('theme',isDark?'dark':'light');
    const icon=isDark?'üåô':'‚òÄÔ∏è';
    document.getElementById('theme-icon').textContent=icon;
  }

  function applyTheme(){
    if(!isDark){document.body.setAttribute('data-theme','light');}
    const icon=isDark?'üåô':'‚òÄÔ∏è';
    const ti=document.getElementById('theme-icon');
    if(ti)ti.textContent=icon;
  }

  // ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ
  function toggleSidebar(){
    document.getElementById('sidebar').classList.toggle('open');
    document.getElementById('overlay').classList.toggle('visible');
  }

  // ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ
  function showSignup(){document.getElementById('login-form').style.display='none';document.getElementById('signup-form').style.display='block';}
  function showLogin(){document.getElementById('signup-form').style.display='none';document.getElementById('login-form').style.display='block';}

  async function login(){
    const email=document.getElementById('login-email').value;
    const password=document.getElementById('login-password').value;
    const errEl=document.getElementById('login-error');
    errEl.classList.remove('visible');
    if(!email||!password){errEl.textContent='Please fill in all fields';errEl.classList.add('visible');return;}
    const btn=event.target;btn.disabled=true;btn.textContent='Signing in...';
    const data=await api('/api/auth/login',{method:'POST',body:JSON.stringify({email,password})});
    btn.disabled=false;btn.textContent='Sign in';
    if(data.error){errEl.textContent=data.error;errEl.classList.add('visible');return;}
    token=data.token;localStorage.setItem('tracker_token',token);currentUser=data.user;showApp();
  }

  async function signup(){
    const name=document.getElementById('signup-name').value;
    const email=document.getElementById('signup-email').value;
    const password=document.getElementById('signup-password').value;
    const errEl=document.getElementById('signup-error');
    errEl.classList.remove('visible');
    if(!name||!email||!password){errEl.textContent='Please fill in all fields';errEl.classList.add('visible');return;}
    if(password.length<6){errEl.textContent='Password must be at least 6 characters';errEl.classList.add('visible');return;}
    const btn=event.target;btn.disabled=true;btn.textContent='Creating...';
    const data=await api('/api/auth/signup',{method:'POST',body:JSON.stringify({name,email,password})});
    btn.disabled=false;btn.textContent='Create account';
    if(data.error){errEl.textContent=data.error;errEl.classList.add('visible');return;}
    token=data.token;localStorage.setItem('tracker_token',token);currentUser=data.user;showApp();
  }

  function logout(){
    localStorage.removeItem('tracker_token');token=null;currentUser=null;
    document.getElementById('app').classList.remove('active');
    document.getElementById('login-page').classList.add('active');
  }

  function showApp(){
    document.getElementById('login-page').classList.remove('active');
    document.getElementById('app').classList.add('active');
    document.getElementById('user-name').textContent=currentUser.name||currentUser.email;
    document.getElementById('user-role').textContent=currentUser.role;
    document.getElementById('user-avatar').textContent=(currentUser.name||currentUser.email)[0].toUpperCase();
    document.getElementById('current-date').textContent=new Date().toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'});
    applyTheme();
    renderPostbackURL();
    loadDashboard();
    loadPixelSettings();
    loadNotificationSettings();
    document.getElementById('spend-date').value=new Date().toISOString().split('T')[0];
  }

  // ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
  function showPage(page,btn){
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
    document.getElementById('page-'+page).classList.add('active');
    if(btn)btn.classList.add('active');
    currentPage=page;
    const titles={dashboard:'Dashboard',orders:'Orders',analytics:'Analytics',clickmap:'Click Map',roi:'ROI',postback:'Postback URLs','pixels-meta':'Meta ‚Äî Pixel Settings','pixels-youtube':'YouTube ‚Äî Pixel Settings','pixels-tiktok':'TikTok ‚Äî Pixel Settings',notifications:'Notifications'};
    const t=titles[page]||page;
    document.getElementById('page-title').textContent=t;
    document.getElementById('mobile-title').textContent=t;
    if(page==='orders')loadOrders(currentOrderPeriod);
    if(page==='analytics')loadAnalytics(currentAnalyticsPeriod);
    if(page==='clickmap')loadClickmap(currentClickmapPeriod);
    if(page==='roi')loadROI(currentROIPeriod);
    if(page.startsWith('pixels-'))renderPixelForm(page.replace('pixels-',''));
    // Close mobile sidebar
    document.getElementById('sidebar').classList.remove('open');
    document.getElementById('overlay').classList.remove('visible');
  }

  function refreshPage(){
    if(currentPage==='dashboard')loadDashboard();
    else if(currentPage==='orders')loadOrders(currentOrderPeriod);
    else if(currentPage==='analytics')loadAnalytics(currentAnalyticsPeriod);
    else if(currentPage==='clickmap')loadClickmap(currentClickmapPeriod);
    else if(currentPage==='roi')loadROI(currentROIPeriod);
  }

  // ‚îÄ‚îÄ POSTBACK URL ‚îÄ‚îÄ
  function renderPostbackURL(){
    const base=window.location.origin;
    const uid=currentUser?.id||'YOUR_USER_ID';
    const url=`${base}/postback?click_id={CLICK_ID}&payout={PAYOUT}&transaction_id={TRANSACTION_ID}&offer_id={OFFER_ID}&network=adexico&offer_name={OFFER_NAME}&country={COUNTRY}&user_id=${uid}`;
    document.getElementById('postback-url-display').textContent=url;
  }

  function copyPostback(){
    const url=document.getElementById('postback-url-display').textContent;
    navigator.clipboard.writeText(url);
    const el=document.getElementById('copy-success');
    el.classList.add('visible');
    setTimeout(()=>el.classList.remove('visible'),2500);
  }

  // ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ
  async function loadDashboard(){
    const stats=await api('/api/stats');
    if(stats.error)return;
    document.getElementById('revenue-today').innerHTML=`<span class="currency">$</span>${fmt(stats.revenue_today)}`;
    document.getElementById('orders-today').textContent=stats.orders_today||0;
    document.getElementById('revenue-total').innerHTML=`<span class="currency">$</span>${fmt(stats.revenue_total)}`;
    document.getElementById('conv-rate').textContent=`${(stats.conversion_rate||0).toFixed(1)}%`;
    document.getElementById('conv-big').textContent=(stats.conversion_rate||0).toFixed(1);
    document.getElementById('conv-fill').style.width=`${Math.min((stats.conversion_rate||0)*5,100)}%`;
    document.getElementById('conv-bar-right').textContent=`${(stats.conversion_rate||0).toFixed(1)}%`;
    document.getElementById('conv-desc').textContent=`${stats.total_clicks||0} clicks ‚Üí ${stats.total_orders||0} orders`;
    document.getElementById('conv-label').textContent=`${stats.total_clicks||0} tracked clicks`;
    document.getElementById('total-label').textContent=`${stats.total_orders||0} total orders`;
    document.getElementById('recent-badge').textContent=`${stats.orders_today||0} today`;
    const rc=stats.revenue_change||0,oc=stats.orders_change||0;
    document.getElementById('revenue-change').innerHTML=`<span class="${rc>=0?'up':'down'}">${rc>=0?'‚Üë':'‚Üì'} ${Math.abs(rc).toFixed(1)}% vs yesterday</span>`;
    document.getElementById('orders-change').innerHTML=`<span class="${oc>=0?'up':'down'}">${oc>=0?'‚Üë':'‚Üì'} ${Math.abs(oc)} vs yesterday</span>`;
    renderPlatforms(stats.by_platform||[]);
    const orders=await api('/api/orders?limit=8');
    renderOrderRows(orders,'dashboard-tbody',true);
  }

  function renderPlatforms(platforms){
    const total=platforms.reduce((s,p)=>s+parseFloat(p.revenue||0),0);
    const keys=['meta','youtube','tiktok'];
    const map={};platforms.forEach(p=>{map[gp(p.source)]=p;});
    document.getElementById('platform-list').innerHTML=keys.map(k=>{
      const p=map[k];const rev=p?parseFloat(p.revenue||0):0;
      const pct=total>0?(rev/total*100):0;const cfg=PC[k];
      return `<div class="platform-row"><div class="platform-info"><div class="platform-dot" style="background:${cfg.color}"></div><div class="platform-name">${cfg.label}</div></div><div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:${cfg.color};opacity:0.8"></div></div><div class="platform-amount">$${fmt(rev)}</div></div>`;
    }).join('');
  }

  // ‚îÄ‚îÄ ORDERS ‚îÄ‚îÄ
  function filterOrders(period,btn){
    currentOrderPeriod=period;
    document.querySelectorAll('#page-orders .filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');loadOrders(period);
  }

  async function loadOrders(period){
    const url=period==='all'?'/api/orders?limit=200':`/api/orders?limit=200&period=${period}`;
    allOrders=await api(url);
    document.getElementById('orders-badge').textContent=`${Array.isArray(allOrders)?allOrders.length:0} orders`;
    renderOrderRows(allOrders,'orders-tbody',false);
  }

  function searchOrders(){
    const q=document.getElementById('order-search').value.toLowerCase();
    if(!q){renderOrderRows(allOrders,'orders-tbody',false);return;}
    const filtered=allOrders.filter(o=>(o.transaction_id||'').toLowerCase().includes(q));
    renderOrderRows(filtered,'orders-tbody',false);
  }

  function exportCSV(){
    if(!allOrders.length){alert('No orders to export');return;}
    const headers=['Transaction ID','Platform','Offer','Campaign','Country','Device','Payout','Network','Time'];
    const rows=allOrders.map(o=>[o.transaction_id,gp(o.traffic_source),o.offer_name||'',o.campaign_id||'',o.country||'',o.device_type||'',o.payout,o.network,o.received_at].map(v=>`"${v||''}"`).join(','));
    const csv=[headers.join(','),...rows].join('\n');
    const a=document.createElement('a');a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);
    a.download=`orders_${new Date().toISOString().split('T')[0]}.csv`;a.click();
  }

  function renderOrderRows(orders,tbodyId,compact){
    const tbody=document.getElementById(tbodyId);
    const cols=compact?6:9;
    if(!orders||!orders.length){
      tbody.innerHTML=`<tr><td colspan="${cols}"><div class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-title">No orders yet</div></div></td></tr>`;return;
    }
    tbody.innerHTML=orders.map(o=>{
      const pk=gp(o.traffic_source);const cfg=PC[pk];
      const pixels=`<div class="pixel-cell"><div class="pixel-dot ${o.pixel_fired_fb?'pixel-on':'pixel-off'}">FB</div><div class="pixel-dot ${o.pixel_fired_tt?'pixel-on':'pixel-off'}">TT</div></div>`;
      if(compact)return `<tr><td class="id-cell">${(o.transaction_id||'‚Äì').substring(0,14)}...</td><td><span class="platform-tag ${cfg.tag}"><span class="tag-dot"></span>${cfg.label}</span></td><td style="color:var(--muted2)">${o.campaign_id||'‚Äì'}</td><td class="payout-cell">+$${fmt(o.payout)}</td><td>${pixels}</td><td class="time-cell">${timeAgo(o.received_at)}</td></tr>`;
      return `<tr><td class="id-cell">${(o.transaction_id||'‚Äì').substring(0,14)}...</td><td><span class="platform-tag ${cfg.tag}"><span class="tag-dot"></span>${cfg.label}</span></td><td style="color:var(--muted2);font-size:11px">${o.offer_name||'‚Äì'}</td><td style="color:var(--muted2);font-size:11px">${o.campaign_id||'‚Äì'}</td><td style="color:var(--muted2);font-size:11px">${o.country||'‚Äì'}</td><td style="color:var(--muted2);font-size:11px">${o.device_type||'‚Äì'}</td><td class="payout-cell">+$${fmt(o.payout)}</td><td style="color:var(--muted2);font-size:11px">${o.network||'‚Äì'}</td><td class="time-cell">${timeAgo(o.received_at)}</td></tr>`;
    }).join('');
  }

  // ‚îÄ‚îÄ ANALYTICS ‚îÄ‚îÄ
  function filterAnalytics(period,btn){
    currentAnalyticsPeriod=period;
    document.querySelectorAll('#page-analytics .filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');loadAnalytics(period);
  }

  async function loadAnalytics(period){
    const data=await api(`/api/analytics?period=${period}`);
    const grid=document.getElementById('analytics-grid');
    if(!data||!data.length){grid.innerHTML=`<div class="empty-state"><div class="empty-icon">üìä</div><div class="empty-title">No data for this period</div></div>`;return;}
    grid.innerHTML=data.map(r=>{
      const pk=gp(r.platform);const cfg=PC[pk];
      return `<div class="analytics-card"><div class="ac-platform" style="background:${cfg.color}20;color:${cfg.color};border:1px solid ${cfg.color}30"><span class="tag-dot" style="background:${cfg.color}"></span>${cfg.label}</div><div class="ac-offer">${r.offer_name||'Unknown Offer'}</div><div class="ac-url">${r.landing_page_url||r.campaign_id||'‚Äì'}</div><div class="ac-stats"><div class="ac-stat"><div class="ac-stat-val" style="color:var(--green)">$${fmt(r.revenue)}</div><div class="ac-stat-label">Revenue</div></div><div class="ac-stat"><div class="ac-stat-val">${r.sales}</div><div class="ac-stat-label">Sales</div></div><div class="ac-stat"><div class="ac-stat-val">$${fmt(r.avg_payout)}</div><div class="ac-stat-label">Avg</div></div></div><div class="ac-meta">${r.ad_creative?`<span class="ac-chip">üé® ${r.ad_creative}</span>`:''} ${r.country?`<span class="ac-chip">üåç ${r.country}</span>`:''} ${r.device_type?`<span class="ac-chip">üì± ${r.device_type}</span>`:''}</div></div>`;
    }).join('');
  }

  // ‚îÄ‚îÄ CLICK MAP ‚îÄ‚îÄ
  function filterClickmap(period,btn){
    currentClickmapPeriod=period;
    document.querySelectorAll('#page-clickmap .filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');loadClickmap(period);
  }

  async function loadClickmap(period){
    const data=await api(`/api/clickmap?period=${period}`);
    const list=document.getElementById('clickmap-list');
    if(!data||!data.length){list.innerHTML=`<div class="empty-state"><div class="empty-icon">üó∫</div><div class="empty-title">No click data yet</div></div>`;return;}
    list.innerHTML=data.map(r=>{
      const pk=gp(r.traffic_source);const cfg=PC[pk];
      const cvr=parseFloat(r.cvr||0);
      return `<div class="clickmap-row"><div><div class="cm-campaign">${r.campaign_id||'Unknown campaign'} <span class="platform-tag ${cfg.tag}" style="font-size:9px">${cfg.label}</span></div><div class="cm-ad">${r.ad_id||'‚Äì'}</div></div><div class="cm-num" style="color:var(--text)">${r.clicks}</div><div class="cm-num" style="color:var(--green)">${r.conversions}</div><div class="cm-num" style="color:${cvr>3?'var(--green)':cvr>1?'var(--orange)':'var(--red)'}">${cvr}%</div><div class="cm-num" style="color:var(--green)">$${fmt(r.revenue)}</div></div>`;
    }).join('');
  }

  // ‚îÄ‚îÄ ROI ‚îÄ‚îÄ
  function filterROI(period,btn){
    currentROIPeriod=period;
    document.querySelectorAll('#page-roi .filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');loadROI(period);
  }

  async function loadROI(period){
    const data=await api(`/api/roi?period=${period}`);
    const grid=document.getElementById('roi-grid');
    if(!data||!data.length){grid.innerHTML=`<div class="empty-state"><div class="empty-icon">üí∞</div><div class="empty-title">No ROI data yet</div><div class="empty-sub">Add ad spend to calculate profit</div></div>`;return;}
    grid.innerHTML=data.map(r=>{
      const pk=gp(r.platform);const cfg=PC[pk];
      const profit=parseFloat(r.profit||0);
      const profitClass=profit>0?'positive':profit<0?'negative':'neutral';
      const roi=parseFloat(r.spend||0)>0?((profit/parseFloat(r.spend))*100).toFixed(0):null;
      return `<div class="roi-card"><div class="roi-offer">${r.offer_name||'Unknown Offer'}</div><div class="roi-platform" style="background:${cfg.color}20;color:${cfg.color};border:1px solid ${cfg.color}30"><span class="tag-dot" style="background:${cfg.color}"></span>${cfg.label}</div><div class="roi-stats"><div class="roi-stat"><div class="roi-stat-val" style="color:var(--green)">$${fmt(r.revenue)}</div><div class="roi-stat-label">Revenue</div></div><div class="roi-stat"><div class="roi-stat-val" style="color:var(--red)">$${fmt(r.spend)}</div><div class="roi-stat-label">Spend</div></div></div><div class="roi-profit ${profitClass}">${profit>=0?'+':''}$${fmt(profit)} profit${roi?` ¬∑ ${roi}% ROI`:''}</div></div>`;
    }).join('');
  }

  async function saveSpend(){
    const platform=document.getElementById('spend-platform').value;
    const campaign_id=document.getElementById('spend-campaign').value;
    const offer_name=document.getElementById('spend-offer').value;
    const spend=document.getElementById('spend-amount').value;
    const spend_date=document.getElementById('spend-date').value;
    if(!spend){alert('Please enter a spend amount');return;}
    await api('/api/spend',{method:'POST',body:JSON.stringify({platform,campaign_id,offer_name,spend,spend_date})});
    document.getElementById('spend-modal').classList.remove('visible');
    loadROI(currentROIPeriod);
  }

  // ‚îÄ‚îÄ PIXEL SETTINGS ‚îÄ‚îÄ
  async function loadPixelSettings(){
    const data=await api('/api/pixels');
    if(Array.isArray(data))data.forEach(p=>{pixelData[p.platform]=p;});
  }

  function renderPixelForm(platform){
    const p=pixelData[platform]||{};
    const cfg=PC[platform]||PC.unknown;
    const L={meta:{id:'Pixel ID',token:'Access Token (CAPI)',idph:'e.g. 1234567890',tokenph:'e.g. EAAxxxxxx'},youtube:{id:'Conversion ID',token:'Conversion Label',idph:'e.g. AW-123456789',tokenph:'e.g. abcDEFghij'},tiktok:{id:'Pixel ID',token:'Access Token',idph:'e.g. CXXXXXXXXX',tokenph:'e.g. xxxxxx'}};
    const l=L[platform]||L.meta;
    document.getElementById(`pf-${platform}`).innerHTML=`
      <div class="pixel-form-card">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
          <div style="width:42px;height:42px;border-radius:10px;background:${cfg.color}20;border:1px solid ${cfg.color}30;display:flex;align-items:center;justify-content:center;font-size:20px">${cfg.icon}</div>
          <div><div style="font-size:16px;font-weight:700;color:var(--white)">${cfg.label}</div><div style="font-size:11px;color:var(--muted2)">Pixel & API Configuration ¬∑ ${p.pixel_id?'<span style="color:var(--green)">Connected</span>':'<span style="color:var(--muted2)">Not configured</span>'}</div></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label class="form-label">${l.id}</label><input class="form-input" type="text" id="${platform}-pixel-id" value="${p.pixel_id||''}" placeholder="${l.idph}"></div>
          <div class="form-group"><label class="form-label">${l.token}</label><input class="form-input" type="text" id="${platform}-access-token" value="${p.access_token||''}" placeholder="${l.tokenph}"></div>
        </div>
        <button class="btn-save" onclick="savePixel('${platform}')">Save & Connect</button>
        <div class="success-msg" id="${platform}-success">‚úì Saved ‚Äî pixel connected and active</div>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title">Where to find your credentials</div></div>
        <div class="card-body" style="font-size:12px;color:var(--muted2);line-height:2">
          ${platform==='meta'?`<b style="color:var(--text)">Pixel ID:</b> Facebook Events Manager ‚Üí Your Dataset ‚Üí Settings ‚Üí Dataset ID<br><b style="color:var(--text)">Access Token:</b> Events Manager ‚Üí Settings ‚Üí Conversions API ‚Üí Generate Access Token`:platform==='youtube'?`<b style="color:var(--text)">Conversion ID:</b> Google Ads ‚Üí Tools ‚Üí Conversions ‚Üí your conversion ‚Üí Tag setup ‚Üí Conversion ID<br><b style="color:var(--text)">Conversion Label:</b> Same page ‚Äî Conversion Label field`:`<b style="color:var(--text)">Pixel ID:</b> TikTok Ads Manager ‚Üí Assets ‚Üí Events ‚Üí Web Events ‚Üí your pixel<br><b style="color:var(--text)">Access Token:</b> Same page ‚Üí Events API tab ‚Üí Generate Access Token`}
        </div>
      </div>`;
  }

  async function savePixel(platform){
    const pixel_id=document.getElementById(`${platform}-pixel-id`).value;
    const access_token=document.getElementById(`${platform}-access-token`).value;
    const data=await api('/api/pixels',{method:'POST',body:JSON.stringify({platform,pixel_id,access_token,enabled:true})});
    if(data.id){pixelData[platform]=data;const m=document.getElementById(`${platform}-success`);m.classList.add('visible');setTimeout(()=>{m.classList.remove('visible');renderPixelForm(platform);},3000);}
  }

  // ‚îÄ‚îÄ NOTIFICATIONS ‚îÄ‚îÄ
  async function loadNotificationSettings(){
    const data=await api('/api/notifications');
    if(data.pushover_user_key)document.getElementById('notif-user-key').value=data.pushover_user_key;
    if(data.pushover_api_token)document.getElementById('notif-api-token').value=data.pushover_api_token;
  }

  async function saveNotifications(){
    const pushover_user_key=document.getElementById('notif-user-key').value;
    const pushover_api_token=document.getElementById('notif-api-token').value;
    await api('/api/notifications',{method:'POST',body:JSON.stringify({pushover_user_key,pushover_api_token,enabled:true})});
    const m=document.getElementById('notif-success');m.classList.add('visible');setTimeout(()=>m.classList.remove('visible'),3000);
  }

  async function testNotification(){
    const data=await api('/api/notifications/test',{method:'POST'});
    if(data.success)alert('‚úì Test notification sent! Check your iPhone.');
    else alert('Error: '+( data.error||'Make sure you saved your Pushover keys first'));
  }

  // ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
  async function init(){
    applyTheme();
    if(token){
      const me=await api('/api/auth/me');
      if(me.id){currentUser=me;showApp();}
      else{localStorage.removeItem('tracker_token');}
    }
  }

  init();
  setInterval(()=>{if(currentPage==='dashboard')loadDashboard();},30000);
</script>
</body>
</html>